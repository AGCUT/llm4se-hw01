# 水印批处理工具

> ✨ **轻量级版本** - 基于 Tkinter 重构，exe 文件仅 **30-50 MB**（之前 278 MB）

最终可执行文件路径为 `llm4se-hw01\hw01\dist\watermark_tool.exe`，请在 Windows 系统下打开。

## ⚡ 版本亮点

- 🎯 **体积优化**: exe 文件从 278 MB 压缩到 30-50 MB，减少 **80%+**
- 🚀 **启动更快**: 使用 Tkinter 替代 PyQt5，启动速度提升
- 💾 **内存优化**: 运行时内存占用更低
- ✅ **符合规范**: 文件大小符合 GitHub 100 MB 限制

## 功能特性

### 文件处理
- **导入图片**: 支持批量导入图片文件或整个文件夹
- **格式支持**: 输入格式支持 JPEG、PNG、BMP、TIFF（PNG 支持透明通道），输出格式可选择 JPEG 或 PNG
- **导出设置**: 可指定输出文件夹，提供多种命名规则（保留原名、添加前缀/后缀），支持 JPEG 质量调节和图片尺寸调整

### 水印类型
- **文本水印**: 自定义文本内容、字体选择、字号、粗体/斜体、颜色选择、透明度调节、阴影/描边效果
- **图片水印**: 支持 PNG 透明图片作为水印，可调节缩放比例和透明度

### 水印布局与样式
- **位置控制**: 九宫格预设位置（左上/居中/右下等 9 个位置）
- **旋转功能**: 支持 0-360 度任意角度旋转
- **灵活组合**: 可同时使用文本和图片水印，或单独使用

### 配置管理
- **模板系统**: 保存当前水印设置为模板，支持加载、管理和删除模板
- **自动保存**: 程序启动时自动加载上次设置，关闭时自动保存当前配置

## 使用方法

### 运行程序
1. 双击 `watermark_tool.exe` 启动程序
2. 或使用命令行：`watermark_tool.exe`

### 基本操作流程
1. **导入图片**: 点击"导入图片"或"导入文件夹"按钮选择图片
2. **设置水印**: 
   - 勾选"使用文本水印"或"使用图片水印"
   - 在右侧面板设置水印内容、字体、颜色、大小等
   - 选择水印位置（九宫格）和旋转角度
3. **导出图片**: 设置输出目录和命名规则，点击"开始导出"

### 模板管理
1. **保存模板**: 设置好水印参数后，输入模板名称，点击"保存模板"
2. **加载模板**: 从"模板列表"中选择模板，点击"载入"
3. **删除模板**: 选择模板后点击"删除"

## 系统要求

- Windows 10/11 (64位)
- 无需安装Python或其他依赖

## 文件说明

- `watermark_tool.exe`: 主程序可执行文件
- 模板文件保存在: `%USERPROFILE%\.watermark_tool\templates\`
- 上次设置自动保存为: `%USERPROFILE%\.watermark_tool\templates\last.json`

## 技术实现

- **界面框架**: Tkinter（Python 内置，无需额外依赖）
- **图像处理**: Pillow (PIL)
- **打包工具**: PyInstaller
- **支持格式**: JPEG, PNG, BMP, TIFF

## 开发说明

### 环境要求
- Python 3.8+
- Windows 10/11

### 安装依赖
```bash
cd hw01
pip install -r requirements.txt
```

### 运行源码
```bash
python main.py
```

### 打包为 exe
```bash
.\pack-win.ps1
```

或手动执行：
```bash
pyinstaller watermark_tool.spec
```

打包后的 exe 文件位于 `dist/watermark_tool.exe`

### 项目结构
```
hw01/
├── app/
│   ├── __init__.py
│   ├── ui.py          # Tkinter UI 界面
│   ├── exporter.py    # 导出逻辑
│   └── utils.py       # 工具函数
├── main.py            # 程序入口
├── requirements.txt   # 依赖列表
├── watermark_tool.spec # PyInstaller 配置
├── pack-win.ps1       # 打包脚本
├── README.md          # 使用说明
└── MIGRATION_GUIDE.md # 迁移指南
```

## 注意事项

- ⚠️ 建议不要将输出目录设置为原图片所在目录，避免覆盖原图
- 💡 图片水印建议使用 PNG 格式以支持透明效果
- 📁 程序会自动创建模板存储目录，无需手动创建
- 🔤 支持的字体：微软雅黑、Arial、宋体（需系统已安装）

## 更新日志

### v2.0 (Tkinter 版本)
- 🎯 使用 Tkinter 重构 UI，exe 体积减少 80%+
- ⚡ 提升启动速度和运行性能
- ✨ 简化界面，保留核心功能
- 📦 符合 GitHub 文件大小限制

### v1.0 (PyQt5 版本)
- ✅ 基础水印功能
- ✅ 实时预览
- ✅ 模板管理
