# Webç‰ˆAIæ—…è¡Œè§„åˆ’å¸?æŠ€æœ¯æ¶æ„è®¾è®¡æ–‡æ¡?

## æ–‡æ¡£ç‰ˆæœ¬
- ç‰ˆæœ¬ï¼šv1.0
- æ—¥æœŸï¼?025-11-07
- çŠ¶æ€ï¼šè®¾è®¡é˜¶æ®µ

---

## ç›®å½•
1. [ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ](#ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ)
2. [æŠ€æœ¯æ ˆé€‰å‹](#æŠ€æœ¯æ ˆé€‰å‹)
3. [åŠŸèƒ½æ¨¡å—æŠ€æœ¯æ˜ å°„](#åŠŸèƒ½æ¨¡å—æŠ€æœ¯æ˜ å°?
4. [é¡¹ç›®ç›®å½•ç»“æ„](#é¡¹ç›®ç›®å½•ç»“æ„)
5. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®?
6. [APIè®¾è®¡](#apiè®¾è®¡)
7. [éƒ¨ç½²æ¶æ„](#éƒ¨ç½²æ¶æ„)
8. [å¼€å‘å·¥å…·é“¾](#å¼€å‘å·¥å…·é“¾)

---

## ä¸€ã€ç³»ç»Ÿæ¶æ„æ¦‚è§?

### 1.1 æ•´ä½“æ¶æ„å›?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
â”?                        ç”¨æˆ·å±?                               â”?
â”? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?   â”?
â”? â”?æ¡Œé¢æµè§ˆå™?â”? â”?å¹³æ¿æµè§ˆå™?â”? â”?ç§»åŠ¨æµè§ˆå™?â”? â”?PWAåº”ç”¨  â”?   â”?
â”? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?   â”?
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
                         â”?HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
â”?                     CDN / Nginx                             â”?
â”?                  (é™æ€èµ„æº?+ åå‘ä»£ç†)                        â”?
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
                         â”?
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
        â”?                                â”?
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”?             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
â”?  å‰ç«¯åº”ç”¨       â”?             â”?   åç«¯æœåŠ¡        â”?
â”? (React/Vue)   â”‚â—„â”€â”€â”€â”€APIâ”€â”€â”€â”€â”€â–ºâ”‚  (Node.js/FastAPI)â”?
â”?               â”?             â”?                  â”?
â”?- è¯­éŸ³è¾“å…¥      â”?             â”?- RESTful API     â”?
â”?- åœ°å›¾å±•ç¤º      â”?             â”?- WebSocket       â”?
â”?- è¡Œç¨‹ç®¡ç†      â”?             â”?- ä¸šåŠ¡é€»è¾‘         â”?
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
                                          â”?
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
                         â”?               â”?               â”?
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”? â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”? â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”?
                â”? æ•°æ®åº“æœåŠ?    â”? â”? ç¬¬ä¸‰æ–¹æœåŠ? â”? â”? AIæœåŠ¡   â”?
                â”? (Supabase)   â”? â”?            â”? â”?          â”?
                â”?              â”? â”?- é«˜å¾·åœ°å›¾   â”? â”?- é€šä¹‰åƒé—® â”?
                â”?- PostgreSQL  â”? â”?- è®¯é£è¯­éŸ³   â”? â”?- GPT-4   â”?
                â”?- Redisç¼“å­˜   â”? â”?- OSSå­˜å‚¨   â”? â”?- æ–‡å¿ƒä¸€è¨€ â”?
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
```

### 1.2 æ¶æ„ç‰¹ç‚¹
- **å‰åç«¯åˆ†ç¦?*ï¼šç‹¬ç«‹å¼€å‘ã€éƒ¨ç½²ã€æ‰©å±?
- **å¾®æœåŠ¡å‹å¥?*ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºåæœŸæ‹†åˆ?
- **äº‘åŸç”?*ï¼šå®¹å™¨åŒ–éƒ¨ç½²ï¼Œæ”¯æŒå¼¹æ€§ä¼¸ç¼?
- **é«˜å¯ç”?*ï¼šæ•°æ®åº“ä¸»ä»ã€Redisç¼“å­˜ã€CDNåŠ é€?

---

## äºŒã€æŠ€æœ¯æ ˆé€‰å‹

### 2.1 å‰ç«¯æŠ€æœ¯æ ˆ

#### æ ¸å¿ƒæ¡†æ¶
```json
{
  "æ¡†æ¶": "React 18.2.0",
  "ç†ç”±": "ç”Ÿæ€å®Œå–„ã€æ€§èƒ½ä¼˜ç§€ã€ç¤¾åŒºæ´»è·?,
  "å¤‡é€‰æ–¹æ¡?: "Vue 3.3 + Vite"
}
```

#### å®Œæ•´æŠ€æœ¯æ ˆæ¸…å•

| ç±»åˆ« | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬ | ç”¨é€?|
|------|---------|------|------|
| **UIæ¡†æ¶** | React | 18.2+ | ç»„ä»¶åŒ–å¼€å?|
| **æ„å»ºå·¥å…·** | Vite | 5.0+ | å¿«é€Ÿæ„å»ºã€HMR |
| **è·¯ç”±** | React Router | 6.20+ | é¡µé¢è·¯ç”±ç®¡ç† |
| **çŠ¶æ€ç®¡ç?* | Zustand | 4.4+ | è½»é‡çº§çŠ¶æ€ç®¡ç?|
| **æ•°æ®è¯·æ±‚** | TanStack Query | 5.0+ | æ•°æ®è·å–ã€ç¼“å­?|
| **UIç»„ä»¶åº?* | Ant Design | 5.12+ | åŸºç¡€ç»„ä»¶ |
| **æ ·å¼æ–¹æ¡ˆ** | Tailwind CSS | 3.4+ | åŸå­åŒ–CSS |
| **åœ°å›¾SDK** | é«˜å¾·åœ°å›¾ JS API | 2.0 | åœ°å›¾å±•ç¤ºã€å¯¼èˆ?|
| **è¯­éŸ³è¯†åˆ«** | Web Speech API / è®¯é£WebSocket | - | è¯­éŸ³è½¬æ–‡å­?|
| **å›¾è¡¨åº?* | ECharts | 5.4+ | æ•°æ®å¯è§†åŒ?|
| **è¡¨å•ç®¡ç†** | React Hook Form | 7.49+ | è¡¨å•éªŒè¯ |
| **æ—¥æœŸå¤„ç†** | Day.js | 1.11+ | æ—¥æœŸæ ¼å¼åŒ?|
| **HTTPå®¢æˆ·ç«?* | Axios | 1.6+ | APIè¯·æ±‚ |
| **å®æ—¶é€šä¿¡** | Socket.io-client | 4.6+ | WebSocketè¿æ¥ |
| **åŠ¨ç”»åº?* | Framer Motion | 10.16+ | æµç•…åŠ¨ç”» |
| **å›½é™…åŒ?* | i18next | 23.7+ | å¤šè¯­è¨€æ”¯æŒ |
| **TypeScript** | TypeScript | 5.3+ | ç±»å‹å®‰å…¨ |

#### å¼€å‘å·¥å…?
```json
{
  "ä»£ç è§„èŒƒ": {
    "ESLint": "8.56.0",
    "Prettier": "3.1.1",
    "lint-staged": "15.2.0"
  },
  "æµ‹è¯•å·¥å…·": {
    "Vitest": "1.1.0",
    "Testing Library": "14.1.2",
    "Playwright": "1.40.0"
  },
  "ç±»å‹æ£€æŸ?: {
    "TypeScript": "5.3.3"
  }
}
```

### 2.2 åç«¯æŠ€æœ¯æ ˆ

#### æ ¸å¿ƒæ¡†æ¶é€‰æ‹©

**æ–¹æ¡ˆAï¼šNode.js + Expressï¼ˆæ¨èï¼‰**
```json
{
  "runtime": "Node.js 20 LTS",
  "framework": "Express 4.18",
  "language": "TypeScript 5.3",
  "ä¼˜åŠ¿": "ä¸å‰ç«¯æŠ€æœ¯æ ˆç»Ÿä¸€ã€ç”Ÿæ€ä¸°å¯Œã€å¼€å‘æ•ˆç‡é«˜"
}
```

**æ–¹æ¡ˆBï¼šPython + FastAPI**
```json
{
  "runtime": "Python 3.11",
  "framework": "FastAPI 0.109",
  "ä¼˜åŠ¿": "å¼‚æ­¥é«˜æ€§èƒ½ã€è‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£ã€AIé›†æˆæ–¹ä¾¿"
}
```

#### å®Œæ•´æŠ€æœ¯æ ˆæ¸…å•ï¼ˆä»¥Node.jsæ–¹æ¡ˆä¸ºä¾‹ï¼?

| ç±»åˆ« | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬ | ç”¨é€?|
|------|---------|------|------|
| **è¿è¡Œæ—?* | Node.js | 20 LTS | JavaScriptè¿è¡Œç¯å¢ƒ |
| **Webæ¡†æ¶** | Express | 4.18+ | HTTPæœåŠ¡å™?|
| **è¯­è¨€** | TypeScript | 5.3+ | ç±»å‹å®‰å…¨ |
| **ORM** | Prisma | 5.8+ | æ•°æ®åº“æ“ä½?|
| **è®¤è¯** | Passport.js | 0.7+ | ç”¨æˆ·è®¤è¯ |
| **JWT** | jsonwebtoken | 9.0+ | Tokenç”ŸæˆéªŒè¯ |
| **åŠ å¯†** | bcrypt | 5.1+ | å¯†ç åŠ å¯† |
| **éªŒè¯** | Joi / Zod | 17.11+ / 3.22+ | å‚æ•°éªŒè¯ |
| **æ—¥å¿—** | Winston | 3.11+ | æ—¥å¿—è®°å½• |
| **å®šæ—¶ä»»åŠ¡** | node-cron | 3.0+ | å®šæ—¶ä»»åŠ¡è°ƒåº¦ |
| **é‚®ä»¶** | Nodemailer | 6.9+ | å‘é€é‚®ä»?|
| **WebSocket** | Socket.io | 4.6+ | å®æ—¶é€šä¿¡ |
| **ç¼“å­˜** | ioredis | 5.3+ | Rediså®¢æˆ·ç«?|
| **æ–‡ä»¶ä¸Šä¼ ** | Multer | 1.4+ | æ–‡ä»¶å¤„ç† |
| **APIæ–‡æ¡£** | Swagger | 5.0+ | APIæ–‡æ¡£ç”Ÿæˆ |
| **é™æµ** | express-rate-limit | 7.1+ | APIé™æµ |
| **å®‰å…¨** | helmet | 7.1+ | å®‰å…¨å¤´è®¾ç½?|
| **CORS** | cors | 2.8+ | è·¨åŸŸå¤„ç† |

### 2.3 æ•°æ®åº“ä¸å­˜å‚¨

| ç±»åˆ« | æŠ€æœ¯é€‰å‹ | ç”¨é€?|
|------|---------|------|
| **ä¸»æ•°æ®åº“** | PostgreSQL 15 | ç”¨æˆ·æ•°æ®ã€è¡Œç¨‹æ•°æ®ã€è´¹ç”¨è®°å½?|
| **ç¼“å­˜å±?* | Redis 7.2 | Sessionã€çƒ­ç‚¹æ•°æ®ç¼“å­?|
| **å¯¹è±¡å­˜å‚¨** | é˜¿é‡Œäº‘OSS / AWS S3 | ç”¨æˆ·å¤´åƒã€è¡Œç¨‹å›¾ç‰?|
| **æ•°æ®åº“æœåŠ?* | Supabase | æä¾›PostgreSQL + Auth + Storage |

### 2.4 ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ?

| æœåŠ¡ç±»åˆ« | é€‰å‹æ–¹æ¡ˆ | SDK/API | ç”¨é€?|
|---------|---------|---------|------|
| **AIå¤§æ¨¡å?* | é˜¿é‡Œäº‘é€šä¹‰åƒé—® | HTTP API | è¡Œç¨‹ç”Ÿæˆã€æ™ºèƒ½é—®ç­?|
| å¤‡é€?| OpenAI GPT-4 | openai SDK | å›½é™…ç”¨æˆ· |
| å¤‡é€?| DeepSeek | HTTP API | æˆæœ¬ä¼˜åŒ– |
| **åœ°å›¾æœåŠ¡** | é«˜å¾·åœ°å›¾ | JavaScript API 2.0 | åœ°å›¾å±•ç¤ºã€è·¯çº¿è§„åˆ?|
| å¤‡é€?| ç™¾åº¦åœ°å›¾ | JavaScript API 3.0 | å¤‡ç”¨æ–¹æ¡ˆ |
| **è¯­éŸ³è¯†åˆ«** | ç§‘å¤§è®¯é£ | WebSocket API | å®æ—¶è¯­éŸ³è¯†åˆ« |
| å¤‡é€?| é˜¿é‡Œäº‘è¯­éŸ?| HTTP API | è¯­éŸ³è½¬æ–‡å­?|
| å¤‡é€?| Web Speech API | æµè§ˆå™¨åŸç”?| å…è´¹ä½†åŠŸèƒ½æœ‰é™?|
| **çŸ­ä¿¡æœåŠ¡** | é˜¿é‡Œäº‘SMS | HTTP API | éªŒè¯ç å‘é€?|
| **é‚®ä»¶æœåŠ¡** | SendGrid / é˜¿é‡Œé‚®ä»¶æ¨é€?| SMTP/API | é‚®ä»¶é€šçŸ¥ |

### 2.5 DevOpså·¥å…·é“?

| ç±»åˆ« | å·¥å…· | ç”¨é€?|
|------|------|------|
| **ç‰ˆæœ¬æ§åˆ¶** | Git + GitHub | ä»£ç ç®¡ç† |
| **å®¹å™¨åŒ?* | Docker 24+ | åº”ç”¨å®¹å™¨åŒ?|
| **å®¹å™¨ç¼–æ’** | Docker Compose | æœ¬åœ°å¼€å‘ç¯å¢?|
| **CI/CD** | GitHub Actions | è‡ªåŠ¨åŒ–æ„å»ºéƒ¨ç½?|
| **é•œåƒä»“åº“** | é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ?| é•œåƒå­˜å‚¨ |
| **ç›‘æ§** | Prometheus + Grafana | æ€§èƒ½ç›‘æ§ |
| **æ—¥å¿—** | ELK Stack (å¯é€? | æ—¥å¿—åˆ†æ |
| **æ–‡æ¡£** | VitePress / Docusaurus | é¡¹ç›®æ–‡æ¡£ |

---

## ä¸‰ã€åŠŸèƒ½æ¨¡å—æŠ€æœ¯æ˜ å°?

### 3.1 æ™ºèƒ½è¡Œç¨‹è§„åˆ’æ¨¡å—

#### 3.1.1 å¤šæ¨¡æ€è¾“å…¥åŠŸèƒ?

**æŠ€æœ¯æ ˆ**ï¼?
```javascript
{
  "è¯­éŸ³è¾“å…¥": {
    "å‰ç«¯": [
      "Web Speech API (æµè§ˆå™¨åŸç”?",
      "ç§‘å¤§è®¯é£ WebSocket SDK",
      "Reactè‡ªå®šä¹‰Hook: useVoiceRecognition"
    ],
    "åç«¯": [
      "è®¯é£è¯­éŸ³è¯†åˆ«API",
      "WebSocketæœåŠ¡ (Socket.io)"
    ],
    "æµç¨‹": "éº¦å…‹é£?â†?MediaRecorder â†?WebSocket â†?è®¯é£API â†?æ–‡å­—ç»“æœ"
  },
  "æ–‡æœ¬è¾“å…¥": {
    "å‰ç«¯": [
      "React Hook Form (è¡¨å•ç®¡ç†)",
      "Ant Design Inputç»„ä»¶",
      "Zod (æ•°æ®éªŒè¯)"
    ]
  }
}
```

**æ ¸å¿ƒä»£ç ç¤ºä¾‹**ï¼?
```typescript
// hooks/useVoiceRecognition.ts
import { useState, useCallback } from 'react'
import { io } from 'socket.io-client'

export const useVoiceRecognition = () => {
  const [isRecording, setIsRecording] = useState(false)
  const [transcript, setTranscript] = useState('')
  
  const startRecording = useCallback(() => {
    // æ–¹æ¡ˆ1: Web Speech API
    const recognition = new webkitSpeechRecognition()
    recognition.lang = 'zh-CN'
    recognition.continuous = true
    recognition.interimResults = true
    
    recognition.onresult = (event) => {
      const text = event.results[event.results.length - 1][0].transcript
      setTranscript(text)
    }
    
    recognition.start()
    setIsRecording(true)
  }, [])
  
  return { isRecording, transcript, startRecording }
}
```

#### 3.1.2 AIè¡Œç¨‹ç”ŸæˆåŠŸèƒ½

**æŠ€æœ¯æ ˆ**ï¼?
```javascript
{
  "å‰ç«¯": {
    "UI": ["Reactç»„ä»¶", "Ant Design Modal/Steps"],
    "çŠ¶æ€ç®¡ç?: "Zustand (tripStore)",
    "APIè°ƒç”¨": "TanStack Query + Axios",
    "åŠ è½½åŠ¨ç”»": "Framer Motion"
  },
  "åç«¯": {
    "APIè·¯ç”±": "Express Router",
    "ä¸šåŠ¡é€»è¾‘": "TripServiceç±?,
    "AIé›†æˆ": "é˜¿é‡Œäº‘DashScope SDK",
    "Promptç®¡ç†": "æç¤ºè¯æ¨¡æ¿å¼•æ“?,
    "ç»“æœè§£æ": "JSON SchemaéªŒè¯"
  },
  "AIæœåŠ¡": {
    "æ¨¡å‹": "é€šä¹‰åƒé—® qwen-max",
    "è°ƒç”¨æ–¹å¼": "HTTP POST",
    "è¿”å›æ ¼å¼": "JSON",
    "é”™è¯¯å¤„ç†": "é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤?æ¬¡ï¼‰"
  }
}
```

**æ¶æ„æµç¨‹**ï¼?
```
ç”¨æˆ·è¾“å…¥ â†?å‰ç«¯éªŒè¯ â†?APIè¯·æ±‚ 
  â†?
åç«¯æ¥æ”¶ â†?æ„å»ºPrompt â†?è°ƒç”¨LLM API
  â†?
LLMå“åº” â†?è§£æJSON â†?æ•°æ®éªŒè¯ â†?ä¿å­˜æ•°æ®åº?
  â†?
è¿”å›å‰ç«¯ â†?çŠ¶æ€æ›´æ–?â†?UIæ¸²æŸ“
```

**æ ¸å¿ƒä»£ç ç¤ºä¾‹**ï¼?
```typescript
// backend/services/TripService.ts
import axios from 'axios'

export class TripService {
  async generateItinerary(input: TripInput): Promise<TripItinerary> {
    // 1. æ„å»ºPrompt
    const prompt = this.buildPrompt(input)
    
    // 2. è°ƒç”¨AI API
    const response = await axios.post(
      'https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation',
      {
        model: 'qwen-max',
        input: { messages: [{ role: 'user', content: prompt }] },
        parameters: {
          result_format: 'message',
          temperature: 0.7,
          max_tokens: 4000
        }
      },
      {
        headers: {
          'Authorization': `Bearer ${process.env.DASHSCOPE_API_KEY}`,
          'Content-Type': 'application/json'
        }
      }
    )
    
    // 3. è§£æç»“æœ
    const itinerary = JSON.parse(
      response.data.output.choices[0].message.content
    )
    
    // 4. æ•°æ®éªŒè¯
    const validated = ItinerarySchema.parse(itinerary)
    
    // 5. ä¿å­˜æ•°æ®åº?
    return await this.saveToDatabase(validated)
  }
  
  private buildPrompt(input: TripInput): string {
    return `ä½ æ˜¯ä¸“ä¸šçš„æ—…è¡Œè§„åˆ’å¸ˆï¼Œè¯·æ ¹æ®ä»¥ä¸‹éœ€æ±‚ç”Ÿæˆè¡Œç¨‹ï¼š
ç›®çš„åœ°ï¼š${input.destination}
å¤©æ•°ï¼?{input.days}
é¢„ç®—ï¼?{input.budget}å…?
...`
  }
}
```

#### 3.1.3 åœ°å›¾å¯è§†åŒ–åŠŸèƒ?

**æŠ€æœ¯æ ˆ**ï¼?
```javascript
{
  "å‰ç«¯": {
    "åœ°å›¾åº?: "é«˜å¾·åœ°å›¾ JavaScript API 2.0",
    "Reactå°è£…": "@amap/amap-react (æˆ–è‡ªå®šä¹‰å°è£…)",
    "åœ°å›¾ç»„ä»¶": [
      "AMap.Map (åœ°å›¾å®¹å™¨)",
      "AMap.Marker (æ ‡è®°ç‚?",
      "AMap.Polyline (è·¯çº¿)",
      "AMap.InfoWindow (ä¿¡æ¯çª—å£)",
      "AMap.Driving (é©¾è½¦è·¯çº¿è§„åˆ’)"
    ],
    "åœ°å›¾æ’ä»¶": [
      "AMap.ToolBar (ç¼©æ”¾å·¥å…·)",
      "AMap.Scale (æ¯”ä¾‹å°?",
      "AMap.Geolocation (å®šä½)"
    ]
  },
  "æ•°æ®å¤„ç†": {
    "åœ°ç†ç¼–ç ": "é«˜å¾· Geocoding API",
    "è·¯çº¿è§„åˆ’": "é«˜å¾· Direction API",
    "åæ ‡è½¬æ¢": "WGS84 â†?GCJ02"
  }
}
```

**æ ¸å¿ƒä»£ç ç¤ºä¾‹**ï¼?
```typescript
// components/TripMap.tsx
import React, { useEffect, useRef } from 'react'
import AMapLoader from '@amap/amap-jsapi-loader'

interface TripMapProps {
  itinerary: Itinerary
  onMarkerClick: (place: Place) => void
}

export const TripMap: React.FC<TripMapProps> = ({ itinerary, onMarkerClick }) => {
  const mapRef = useRef<any>(null)
  const markersRef = useRef<any[]>([])
  
  useEffect(() => {
    AMapLoader.load({
      key: process.env.REACT_APP_AMAP_KEY,
      version: '2.0',
      plugins: ['AMap.Marker', 'AMap.Polyline', 'AMap.Driving']
    }).then(AMap => {
      // åˆå§‹åŒ–åœ°å›?
      const map = new AMap.Map('map-container', {
        zoom: 12,
        center: itinerary.center
      })
      mapRef.current = map
      
      // æ·»åŠ æ ‡è®°ç‚?
      itinerary.dailyPlans.forEach((day, dayIndex) => {
        day.activities.forEach((activity, actIndex) => {
          if (activity.location) {
            const marker = new AMap.Marker({
              position: [activity.location.lng, activity.location.lat],
              title: activity.name,
              icon: getIconByType(activity.type),
              label: {
                content: `${dayIndex + 1}-${actIndex + 1}`,
                offset: [0, -30]
              }
            })
            
            marker.on('click', () => onMarkerClick(activity))
            map.add(marker)
            markersRef.current.push(marker)
          }
        })
      })
      
      // ç»˜åˆ¶è·¯çº¿
      drawRoutes(map, AMap, itinerary)
    })
    
    return () => {
      mapRef.current?.destroy()
    }
  }, [itinerary])
  
  return <div id="map-container" style={{ width: '100%', height: '600px' }} />
}
```

#### 3.1.4 è¡Œç¨‹ç¼–è¾‘åŠŸèƒ½

**æŠ€æœ¯æ ˆ**ï¼?
```javascript
{
  "å‰ç«¯": {
    "æ‹–æ‹½æ’åº": "dnd-kit (React DnDåº?",
    "è¡¨å•ç¼–è¾‘": "React Hook Form",
    "å³æ—¶ä¿å­˜": "TanStack Query mutation + é˜²æŠ–",
    "ç‰ˆæœ¬å¯¹æ¯”": "diffåº?(å¯è§†åŒ–å·®å¼?"
  },
  "åç«¯": {
    "å¢é‡æ›´æ–°": "PATCHè¯·æ±‚å¤„ç†",
    "ç‰ˆæœ¬æ§åˆ¶": "ä¿å­˜å†å²ç‰ˆæœ¬åˆ°JSONå­—æ®µ",
    "å¹¶å‘æ§åˆ¶": "ä¹è§‚é”ï¼ˆç‰ˆæœ¬å·ï¼‰"
  }
}
```

### 3.2 è´¹ç”¨é¢„ç®—ä¸ç®¡ç†æ¨¡å?

#### 3.2.1 AIé¢„ç®—åˆ†æåŠŸèƒ½

**æŠ€æœ¯æ ˆ**ï¼?
```javascript
{
  "å‰ç«¯": {
    "å›¾è¡¨å±•ç¤º": "Apache ECharts",
    "å›¾è¡¨ç±»å‹": ["é¥¼å›¾", "æŸ±çŠ¶å›?, "æŠ˜çº¿å›?],
    "æ•°æ®å¤„ç†": "lodash (åˆ†ç»„ã€æ±‡æ€?"
  },
  "åç«¯": {
    "é¢„ç®—è®¡ç®—": "ä¸šåŠ¡é€»è¾‘å±?,
    "AIåˆ†æ": "LLMç”Ÿæˆé¢„ç®—å»ºè®®",
    "æ•°æ®èšåˆ": "SQLèšåˆæŸ¥è¯¢"
  }
}
```

**æ ¸å¿ƒä»£ç ç¤ºä¾‹**ï¼?
```typescript
// components/BudgetChart.tsx
import ReactECharts from 'echarts-for-react'

export const BudgetChart = ({ budgetData }) => {
  const option = {
    title: { text: 'é¢„ç®—åˆ†å¸ƒ' },
    tooltip: { trigger: 'item' },
    series: [{
      type: 'pie',
      radius: '50%',
      data: [
        { value: budgetData.transportation, name: 'äº¤é€? },
        { value: budgetData.accommodation, name: 'ä½å®¿' },
        { value: budgetData.food, name: 'é¤é¥®' },
        { value: budgetData.tickets, name: 'é—¨ç¥¨' },
        { value: budgetData.shopping, name: 'è´­ç‰©' }
      ]
    }]
  }
  
  return <ReactECharts option={option} style={{ height: 400 }} />
}
```

#### 3.2.2 è´¹ç”¨è®°å½•åŠŸèƒ½

**æŠ€æœ¯æ ˆ**ï¼?
```javascript
{
  "è¯­éŸ³è®°è´¦": {
    "è¯†åˆ«": "ç§‘å¤§è®¯é£è¯­éŸ³è¯†åˆ«",
    "NLPæå–": "LLMæå–é‡‘é¢å’Œç±»åˆ?,
    "æ­£åˆ™åŒ¹é…": "æå–æ•°å­—å’Œå…³é”®è¯"
  },
  "æ‰‹åŠ¨è®°è´¦": {
    "è¡¨å•": "React Hook Form",
    "å›¾ç‰‡ä¸Šä¼ ": "Multer (åç«¯) + OSS (å­˜å‚¨)",
    "OCRè¯†åˆ«": "é˜¿é‡Œäº‘OCR API (å¯é€?"
  },
  "æ•°æ®å­˜å‚¨": {
    "æ•°æ®åº?: "expensesè¡?,
    "å®æ—¶åŒæ­¥": "WebSocketæ¨é€?
  }
}
```

### 3.3 ç”¨æˆ·ç®¡ç†ä¸æ•°æ®å­˜å‚¨æ¨¡å?

#### 3.3.1 æ³¨å†Œç™»å½•ç³»ç»Ÿ

**æŠ€æœ¯æ ˆ**ï¼?
```javascript
{
  "è®¤è¯æ–¹æ¡ˆ": "JWT + Refresh Token",
  "å‰ç«¯": {
    "è¡¨å•": "React Hook Form + ZodéªŒè¯",
    "çŠ¶æ€ç®¡ç?: "Zustand authStore",
    "Tokenå­˜å‚¨": "localStorage + httpOnly Cookie",
    "è·¯ç”±å®ˆå«": "React Router Loader"
  },
  "åç«¯": {
    "è®¤è¯æ¡†æ¶": "Passport.js",
    "ç­–ç•¥": [
      "passport-local (è´¦å·å¯†ç )",
      "passport-jwt (TokenéªŒè¯)",
      "passport-google-oauth20 (Googleç™»å½•)",
      "passport-github2 (GitHubç™»å½•)"
    ],
    "å¯†ç åŠ å¯†": "bcrypt (æˆæœ¬å› å­12)",
    "Tokenç”Ÿæˆ": "jsonwebtoken",
    "Tokené…ç½®": {
      "accessToken": "15åˆ†é’Ÿ",
      "refreshToken": "7å¤?
    }
  },
  "å®‰å…¨æªæ–½": {
    "é™æµ": "express-rate-limit (5æ¬?15åˆ†é’Ÿ)",
    "CSRFé˜²æŠ¤": "csurfä¸­é—´ä»?,
    "XSSé˜²æŠ¤": "helmet + DOMPurify",
    "SQLæ³¨å…¥": "Prismaå‚æ•°åŒ–æŸ¥è¯?
  }
}
```

**æ ¸å¿ƒä»£ç ç¤ºä¾‹**ï¼?
```typescript
// backend/middleware/auth.ts
import jwt from 'jsonwebtoken'
import { Request, Response, NextFunction } from 'express'

export const authenticate = (req: Request, res: Response, next: NextFunction) => {
  const token = req.headers.authorization?.split(' ')[1]
  
  if (!token) {
    return res.status(401).json({ error: 'æœªæä¾›è®¤è¯ä»¤ç‰? })
  }
  
  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET!)
    req.user = decoded
    next()
  } catch (error) {
    if (error.name === 'TokenExpiredError') {
      return res.status(401).json({ error: 'ä»¤ç‰Œå·²è¿‡æœ? })
    }
    return res.status(403).json({ error: 'æ— æ•ˆçš„ä»¤ç‰? })
  }
}
```

#### 3.3.2 äº‘ç«¯æ•°æ®åŒæ­¥

**æŠ€æœ¯æ ˆ**ï¼?
```javascript
{
  "æ•°æ®åº?: "Supabase (PostgreSQL + å®æ—¶è®¢é˜…)",
  "å®æ—¶åŒæ­¥": {
    "æ–¹æ¡ˆ1": "Supabase Realtime (PostgreSQLè§¦å‘å™?",
    "æ–¹æ¡ˆ2": "Socket.io (è‡ªå®šä¹‰å®ç?",
    "å†²çªè§£å†³": "Last-Write-Wins + ç‰ˆæœ¬å?
  },
  "ç¦»çº¿æ”¯æŒ": {
    "å‰ç«¯": "IndexedDB (Dexie.js)",
    "åŒæ­¥ç­–ç•¥": "ä¸Šçº¿åè‡ªåŠ¨åŒæ­?,
    "å†²çªæ£€æµ?: "ç‰ˆæœ¬æ—¶é—´æˆ³å¯¹æ¯?
  }
}
```

---

## å››ã€é¡¹ç›®ç›®å½•ç»“æ?

### 4.1 å‰ç«¯é¡¹ç›®ç»“æ„

```
frontend/
â”œâ”€â”€ public/                          # é™æ€èµ„æº?
â”?  â”œâ”€â”€ favicon.ico
â”?  â”œâ”€â”€ index.html
â”?  â””â”€â”€ manifest.json                # PWAé…ç½®
â”?
â”œâ”€â”€ src/
â”?  â”œâ”€â”€ api/                         # APIè¯·æ±‚å°è£…
â”?  â”?  â”œâ”€â”€ client.ts                # Axioså®ä¾‹é…ç½®
â”?  â”?  â”œâ”€â”€ auth.api.ts              # è®¤è¯ç›¸å…³API
â”?  â”?  â”œâ”€â”€ trip.api.ts              # è¡Œç¨‹ç›¸å…³API
â”?  â”?  â”œâ”€â”€ expense.api.ts           # è´¹ç”¨ç›¸å…³API
â”?  â”?  â””â”€â”€ types.ts                 # APIç±»å‹å®šä¹‰
â”?  â”?
â”?  â”œâ”€â”€ assets/                      # èµ„æºæ–‡ä»¶
â”?  â”?  â”œâ”€â”€ images/
â”?  â”?  â”œâ”€â”€ icons/
â”?  â”?  â””â”€â”€ styles/
â”?  â”?      â”œâ”€â”€ global.css
â”?  â”?      â””â”€â”€ variables.css
â”?  â”?
â”?  â”œâ”€â”€ components/                  # å…¬å…±ç»„ä»¶
â”?  â”?  â”œâ”€â”€ common/                  # é€šç”¨ç»„ä»¶
â”?  â”?  â”?  â”œâ”€â”€ Button/
â”?  â”?  â”?  â”?  â”œâ”€â”€ Button.tsx
â”?  â”?  â”?  â”?  â”œâ”€â”€ Button.module.css
â”?  â”?  â”?  â”?  â””â”€â”€ index.ts
â”?  â”?  â”?  â”œâ”€â”€ Modal/
â”?  â”?  â”?  â”œâ”€â”€ Loading/
â”?  â”?  â”?  â””â”€â”€ ErrorBoundary/
â”?  â”?  â”?
â”?  â”?  â”œâ”€â”€ layout/                  # å¸ƒå±€ç»„ä»¶
â”?  â”?  â”?  â”œâ”€â”€ Header/
â”?  â”?  â”?  â”œâ”€â”€ Sidebar/
â”?  â”?  â”?  â”œâ”€â”€ Footer/
â”?  â”?  â”?  â””â”€â”€ MainLayout/
â”?  â”?  â”?
â”?  â”?  â”œâ”€â”€ trip/                    # è¡Œç¨‹ç›¸å…³ç»„ä»¶
â”?  â”?  â”?  â”œâ”€â”€ TripCard/
â”?  â”?  â”?  â”œâ”€â”€ TripList/
â”?  â”?  â”?  â”œâ”€â”€ TripMap/
â”?  â”?  â”?  â”œâ”€â”€ DayPlan/
â”?  â”?  â”?  â”œâ”€â”€ ActivityItem/
â”?  â”?  â”?  â””â”€â”€ ActivityEditor/
â”?  â”?  â”?
â”?  â”?  â”œâ”€â”€ expense/                 # è´¹ç”¨ç›¸å…³ç»„ä»¶
â”?  â”?  â”?  â”œâ”€â”€ BudgetChart/
â”?  â”?  â”?  â”œâ”€â”€ ExpenseList/
â”?  â”?  â”?  â”œâ”€â”€ ExpenseForm/
â”?  â”?  â”?  â””â”€â”€ VoiceRecorder/
â”?  â”?  â”?
â”?  â”?  â””â”€â”€ voice/                   # è¯­éŸ³ç›¸å…³ç»„ä»¶
â”?  â”?      â”œâ”€â”€ VoiceInput/
â”?  â”?      â””â”€â”€ VoiceButton/
â”?  â”?
â”?  â”œâ”€â”€ pages/                       # é¡µé¢ç»„ä»¶
â”?  â”?  â”œâ”€â”€ Home/
â”?  â”?  â”?  â”œâ”€â”€ Home.tsx
â”?  â”?  â”?  â””â”€â”€ Home.module.css
â”?  â”?  â”œâ”€â”€ Auth/
â”?  â”?  â”?  â”œâ”€â”€ Login.tsx
â”?  â”?  â”?  â””â”€â”€ Register.tsx
â”?  â”?  â”œâ”€â”€ Dashboard/
â”?  â”?  â”?  â””â”€â”€ Dashboard.tsx
â”?  â”?  â”œâ”€â”€ TripCreate/
â”?  â”?  â”?  â”œâ”€â”€ TripCreate.tsx
â”?  â”?  â”?  â”œâ”€â”€ Steps/
â”?  â”?  â”?  â”?  â”œâ”€â”€ InputStep.tsx
â”?  â”?  â”?  â”?  â”œâ”€â”€ GenerateStep.tsx
â”?  â”?  â”?  â”?  â””â”€â”€ ReviewStep.tsx
â”?  â”?  â”?  â””â”€â”€ index.ts
â”?  â”?  â”œâ”€â”€ TripDetail/
â”?  â”?  â”?  â”œâ”€â”€ TripDetail.tsx
â”?  â”?  â”?  â”œâ”€â”€ Timeline.tsx
â”?  â”?  â”?  â””â”€â”€ MapView.tsx
â”?  â”?  â”œâ”€â”€ ExpenseManage/
â”?  â”?  â”?  â””â”€â”€ ExpenseManage.tsx
â”?  â”?  â”œâ”€â”€ Profile/
â”?  â”?  â”?  â”œâ”€â”€ Profile.tsx
â”?  â”?  â”?  â””â”€â”€ Settings.tsx
â”?  â”?  â””â”€â”€ NotFound/
â”?  â”?      â””â”€â”€ NotFound.tsx
â”?  â”?
â”?  â”œâ”€â”€ hooks/                       # è‡ªå®šä¹‰Hooks
â”?  â”?  â”œâ”€â”€ useAuth.ts               # è®¤è¯Hook
â”?  â”?  â”œâ”€â”€ useVoiceRecognition.ts   # è¯­éŸ³è¯†åˆ«Hook
â”?  â”?  â”œâ”€â”€ useMap.ts                # åœ°å›¾Hook
â”?  â”?  â”œâ”€â”€ useTrips.ts              # è¡Œç¨‹æ•°æ®Hook
â”?  â”?  â”œâ”€â”€ useExpenses.ts           # è´¹ç”¨æ•°æ®Hook
â”?  â”?  â””â”€â”€ useDebounce.ts           # é˜²æŠ–Hook
â”?  â”?
â”?  â”œâ”€â”€ store/                       # çŠ¶æ€ç®¡ç?
â”?  â”?  â”œâ”€â”€ authStore.ts             # è®¤è¯çŠ¶æ€?
â”?  â”?  â”œâ”€â”€ tripStore.ts             # è¡Œç¨‹çŠ¶æ€?
â”?  â”?  â”œâ”€â”€ expenseStore.ts          # è´¹ç”¨çŠ¶æ€?
â”?  â”?  â””â”€â”€ uiStore.ts               # UIçŠ¶æ€?
â”?  â”?
â”?  â”œâ”€â”€ services/                    # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”?  â”?  â”œâ”€â”€ voiceService.ts          # è¯­éŸ³æœåŠ¡
â”?  â”?  â”œâ”€â”€ mapService.ts            # åœ°å›¾æœåŠ¡
â”?  â”?  â”œâ”€â”€ storageService.ts        # æœ¬åœ°å­˜å‚¨æœåŠ¡
â”?  â”?  â””â”€â”€ socketService.ts         # WebSocketæœåŠ¡
â”?  â”?
â”?  â”œâ”€â”€ utils/                       # å·¥å…·å‡½æ•°
â”?  â”?  â”œâ”€â”€ request.ts               # è¯·æ±‚å°è£…
â”?  â”?  â”œâ”€â”€ format.ts                # æ ¼å¼åŒ–å·¥å…?
â”?  â”?  â”œâ”€â”€ validator.ts             # éªŒè¯å·¥å…·
â”?  â”?  â”œâ”€â”€ constants.ts             # å¸¸é‡å®šä¹‰
â”?  â”?  â””â”€â”€ helpers.ts               # è¾…åŠ©å‡½æ•°
â”?  â”?
â”?  â”œâ”€â”€ types/                       # TypeScriptç±»å‹å®šä¹‰
â”?  â”?  â”œâ”€â”€ trip.types.ts
â”?  â”?  â”œâ”€â”€ expense.types.ts
â”?  â”?  â”œâ”€â”€ user.types.ts
â”?  â”?  â””â”€â”€ api.types.ts
â”?  â”?
â”?  â”œâ”€â”€ config/                      # é…ç½®æ–‡ä»¶
â”?  â”?  â”œâ”€â”€ amap.config.ts           # åœ°å›¾é…ç½®
â”?  â”?  â”œâ”€â”€ voice.config.ts          # è¯­éŸ³é…ç½®
â”?  â”?  â””â”€â”€ app.config.ts            # åº”ç”¨é…ç½®
â”?  â”?
â”?  â”œâ”€â”€ App.tsx                      # æ ¹ç»„ä»?
â”?  â”œâ”€â”€ main.tsx                     # å…¥å£æ–‡ä»¶
â”?  â”œâ”€â”€ router.tsx                   # è·¯ç”±é…ç½®
â”?  â””â”€â”€ vite-env.d.ts                # Viteç±»å‹å£°æ˜
â”?
â”œâ”€â”€ tests/                           # æµ‹è¯•æ–‡ä»¶
â”?  â”œâ”€â”€ unit/
â”?  â”œâ”€â”€ integration/
â”?  â””â”€â”€ e2e/
â”?
â”œâ”€â”€ .env.example                     # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .env.local                       # æœ¬åœ°ç¯å¢ƒå˜é‡ï¼ˆä¸æäº¤ï¼?
â”œâ”€â”€ .eslintrc.json                   # ESLinté…ç½®
â”œâ”€â”€ .prettierrc                      # Prettieré…ç½®
â”œâ”€â”€ .gitignore
â”œâ”€â”€ Dockerfile                       # Dockeré…ç½®
â”œâ”€â”€ nginx.conf                       # Nginxé…ç½®
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json                    # TypeScripté…ç½®
â”œâ”€â”€ vite.config.ts                   # Viteé…ç½®
â””â”€â”€ README.md
```

### 4.2 åç«¯é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ src/
â”?  â”œâ”€â”€ controllers/                 # æ§åˆ¶å™¨å±‚
â”?  â”?  â”œâ”€â”€ auth.controller.ts       # è®¤è¯æ§åˆ¶å™?
â”?  â”?  â”œâ”€â”€ user.controller.ts       # ç”¨æˆ·æ§åˆ¶å™?
â”?  â”?  â”œâ”€â”€ trip.controller.ts       # è¡Œç¨‹æ§åˆ¶å™?
â”?  â”?  â”œâ”€â”€ expense.controller.ts    # è´¹ç”¨æ§åˆ¶å™?
â”?  â”?  â””â”€â”€ voice.controller.ts      # è¯­éŸ³æ§åˆ¶å™?
â”?  â”?
â”?  â”œâ”€â”€ services/                    # ä¸šåŠ¡é€»è¾‘å±?
â”?  â”?  â”œâ”€â”€ auth.service.ts
â”?  â”?  â”œâ”€â”€ user.service.ts
â”?  â”?  â”œâ”€â”€ trip.service.ts          # è¡Œç¨‹ç”Ÿæˆé€»è¾‘
â”?  â”?  â”œâ”€â”€ expense.service.ts
â”?  â”?  â”œâ”€â”€ ai.service.ts            # AIé›†æˆæœåŠ¡
â”?  â”?  â”œâ”€â”€ map.service.ts           # åœ°å›¾æœåŠ¡
â”?  â”?  â”œâ”€â”€ voice.service.ts         # è¯­éŸ³è¯†åˆ«æœåŠ¡
â”?  â”?  â”œâ”€â”€ email.service.ts         # é‚®ä»¶æœåŠ¡
â”?  â”?  â””â”€â”€ storage.service.ts       # å¯¹è±¡å­˜å‚¨æœåŠ¡
â”?  â”?
â”?  â”œâ”€â”€ models/                      # æ•°æ®æ¨¡å‹
â”?  â”?  â”œâ”€â”€ User.model.ts
â”?  â”?  â”œâ”€â”€ Trip.model.ts
â”?  â”?  â”œâ”€â”€ Expense.model.ts
â”?  â”?  â””â”€â”€ index.ts
â”?  â”?
â”?  â”œâ”€â”€ routes/                      # è·¯ç”±å®šä¹‰
â”?  â”?  â”œâ”€â”€ auth.routes.ts
â”?  â”?  â”œâ”€â”€ user.routes.ts
â”?  â”?  â”œâ”€â”€ trip.routes.ts
â”?  â”?  â”œâ”€â”€ expense.routes.ts
â”?  â”?  â”œâ”€â”€ voice.routes.ts
â”?  â”?  â””â”€â”€ index.ts
â”?  â”?
â”?  â”œâ”€â”€ middleware/                  # ä¸­é—´ä»?
â”?  â”?  â”œâ”€â”€ auth.middleware.ts       # è®¤è¯ä¸­é—´ä»?
â”?  â”?  â”œâ”€â”€ validate.middleware.ts   # éªŒè¯ä¸­é—´ä»?
â”?  â”?  â”œâ”€â”€ error.middleware.ts      # é”™è¯¯å¤„ç†ä¸­é—´ä»?
â”?  â”?  â”œâ”€â”€ logger.middleware.ts     # æ—¥å¿—ä¸­é—´ä»?
â”?  â”?  â”œâ”€â”€ rateLimit.middleware.ts  # é™æµä¸­é—´ä»?
â”?  â”?  â””â”€â”€ upload.middleware.ts     # æ–‡ä»¶ä¸Šä¼ ä¸­é—´ä»?
â”?  â”?
â”?  â”œâ”€â”€ validators/                  # æ•°æ®éªŒè¯
â”?  â”?  â”œâ”€â”€ auth.validator.ts
â”?  â”?  â”œâ”€â”€ trip.validator.ts
â”?  â”?  â””â”€â”€ expense.validator.ts
â”?  â”?
â”?  â”œâ”€â”€ utils/                       # å·¥å…·å‡½æ•°
â”?  â”?  â”œâ”€â”€ jwt.util.ts              # JWTå·¥å…·
â”?  â”?  â”œâ”€â”€ encryption.util.ts       # åŠ å¯†å·¥å…·
â”?  â”?  â”œâ”€â”€ logger.util.ts           # æ—¥å¿—å·¥å…·
â”?  â”?  â”œâ”€â”€ response.util.ts         # å“åº”æ ¼å¼åŒ?
â”?  â”?  â””â”€â”€ constants.ts             # å¸¸é‡
â”?  â”?
â”?  â”œâ”€â”€ config/                      # é…ç½®æ–‡ä»¶
â”?  â”?  â”œâ”€â”€ database.config.ts       # æ•°æ®åº“é…ç½?
â”?  â”?  â”œâ”€â”€ redis.config.ts          # Redisé…ç½®
â”?  â”?  â”œâ”€â”€ jwt.config.ts            # JWTé…ç½®
â”?  â”?  â”œâ”€â”€ ai.config.ts             # AIæœåŠ¡é…ç½®
â”?  â”?  â”œâ”€â”€ map.config.ts            # åœ°å›¾æœåŠ¡é…ç½®
â”?  â”?  â””â”€â”€ app.config.ts            # åº”ç”¨é…ç½®
â”?  â”?
â”?  â”œâ”€â”€ types/                       # TypeScriptç±»å‹
â”?  â”?  â”œâ”€â”€ express.d.ts             # Expressç±»å‹æ‰©å±•
â”?  â”?  â”œâ”€â”€ api.types.ts
â”?  â”?  â””â”€â”€ service.types.ts
â”?  â”?
â”?  â”œâ”€â”€ prompts/                     # AIæç¤ºè¯æ¨¡æ?
â”?  â”?  â”œâ”€â”€ itinerary.prompt.ts      # è¡Œç¨‹ç”Ÿæˆæç¤ºè¯?
â”?  â”?  â”œâ”€â”€ budget.prompt.ts         # é¢„ç®—åˆ†ææç¤ºè¯?
â”?  â”?  â””â”€â”€ qa.prompt.ts             # é—®ç­”æç¤ºè¯?
â”?  â”?
â”?  â”œâ”€â”€ websocket/                   # WebSocketå¤„ç†
â”?  â”?  â”œâ”€â”€ socketServer.ts          # SocketæœåŠ¡å™?
â”?  â”?  â”œâ”€â”€ handlers/
â”?  â”?  â”?  â”œâ”€â”€ trip.handler.ts
â”?  â”?  â”?  â””â”€â”€ voice.handler.ts
â”?  â”?  â””â”€â”€ middleware/
â”?  â”?      â””â”€â”€ socketAuth.ts
â”?  â”?
â”?  â”œâ”€â”€ database/                    # æ•°æ®åº“ç›¸å…?
â”?  â”?  â”œâ”€â”€ prisma/
â”?  â”?  â”?  â”œâ”€â”€ schema.prisma        # Prisma Schema
â”?  â”?  â”?  â”œâ”€â”€ migrations/          # è¿ç§»æ–‡ä»¶
â”?  â”?  â”?  â””â”€â”€ seed.ts              # ç§å­æ•°æ®
â”?  â”?  â””â”€â”€ redis/
â”?  â”?      â””â”€â”€ client.ts            # Rediså®¢æˆ·ç«?
â”?  â”?
â”?  â”œâ”€â”€ jobs/                        # å®šæ—¶ä»»åŠ¡
â”?  â”?  â”œâ”€â”€ cleanupExpired.job.ts    # æ¸…ç†è¿‡æœŸæ•°æ®
â”?  â”?  â””â”€â”€ index.ts
â”?  â”?
â”?  â”œâ”€â”€ app.ts                       # Expressåº”ç”¨é…ç½®
â”?  â””â”€â”€ server.ts                    # æœåŠ¡å™¨å…¥å?
â”?
â”œâ”€â”€ tests/                           # æµ‹è¯•æ–‡ä»¶
â”?  â”œâ”€â”€ unit/
â”?  â”?  â”œâ”€â”€ services/
â”?  â”?  â””â”€â”€ utils/
â”?  â”œâ”€â”€ integration/
â”?  â”?  â””â”€â”€ api/
â”?  â””â”€â”€ fixtures/                    # æµ‹è¯•æ•°æ®
â”?
â”œâ”€â”€ docs/                            # æ–‡æ¡£
â”?  â”œâ”€â”€ api/
â”?  â”?  â””â”€â”€ swagger.yaml             # APIæ–‡æ¡£
â”?  â””â”€â”€ development.md
â”?
â”œâ”€â”€ scripts/                         # è„šæœ¬
â”?  â”œâ”€â”€ seed.ts                      # æ•°æ®å¡«å……
â”?  â””â”€â”€ migrate.ts                   # æ•°æ®è¿ç§»
â”?
â”œâ”€â”€ .env.example                     # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .env.development                 # å¼€å‘ç¯å¢ƒå˜é‡?
â”œâ”€â”€ .env.production                  # ç”Ÿäº§ç¯å¢ƒå˜é‡ï¼ˆä¸æäº¤ï¼?
â”œâ”€â”€ .eslintrc.json
â”œâ”€â”€ .prettierrc
â”œâ”€â”€ .gitignore
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

### 4.3 å®Œæ•´é¡¹ç›®ç»“æ„ï¼ˆMonorepoï¼?

```
ai-travel-planner/
â”œâ”€â”€ frontend/                        # å‰ç«¯åº”ç”¨ï¼ˆè§4.1ï¼?
â”œâ”€â”€ backend/                         # åç«¯åº”ç”¨ï¼ˆè§4.2ï¼?
â”?
â”œâ”€â”€ shared/                          # å…±äº«ä»£ç ï¼ˆå¯é€‰ï¼‰
â”?  â”œâ”€â”€ types/                       # å…±äº«ç±»å‹å®šä¹‰
â”?  â”?  â”œâ”€â”€ trip.types.ts
â”?  â”?  â””â”€â”€ expense.types.ts
â”?  â””â”€â”€ utils/                       # å…±äº«å·¥å…·å‡½æ•°
â”?
â”œâ”€â”€ docs/                            # é¡¹ç›®æ–‡æ¡£
â”?  â”œâ”€â”€ äº§å“åŠŸèƒ½æ–‡æ¡£.md
â”?  â”œâ”€â”€ æŠ€æœ¯æ¶æ„è®¾è®¡æ–‡æ¡?md
â”?  â”œâ”€â”€ APIæ–‡æ¡£.md
â”?  â”œâ”€â”€ éƒ¨ç½²æŒ‡å—.md
â”?  â””â”€â”€ å¼€å‘æŒ‡å?md
â”?
â”œâ”€â”€ .github/                         # GitHubé…ç½®
â”?  â”œâ”€â”€ workflows/
â”?  â”?  â”œâ”€â”€ frontend-ci.yml          # å‰ç«¯CI
â”?  â”?  â”œâ”€â”€ backend-ci.yml           # åç«¯CI
â”?  â”?  â””â”€â”€ deploy.yml               # éƒ¨ç½²æµç¨‹
â”?  â””â”€â”€ ISSUE_TEMPLATE/
â”?
â”œâ”€â”€ docker/                          # Dockeré…ç½®
â”?  â”œâ”€â”€ frontend.Dockerfile
â”?  â”œâ”€â”€ backend.Dockerfile
â”?  â””â”€â”€ nginx.conf
â”?
â”œâ”€â”€ scripts/                         # é¡¹ç›®è„šæœ¬
â”?  â”œâ”€â”€ setup.sh                     # ç¯å¢ƒæ­å»ºè„šæœ¬
â”?  â”œâ”€â”€ deploy.sh                    # éƒ¨ç½²è„šæœ¬
â”?  â””â”€â”€ backup.sh                    # å¤‡ä»½è„šæœ¬
â”?
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .env.example
â”œâ”€â”€ docker-compose.yml               # å®Œæ•´æœåŠ¡ç¼–æ’
â”œâ”€â”€ package.json                     # æ ¹package.jsonï¼ˆmonorepoï¼?
â”œâ”€â”€ README.md                        # é¡¹ç›®ä¸»æ–‡æ¡?
â””â”€â”€ LICENSE
```

---

## äº”ã€æ•°æ®åº“è®¾è®¡

### 5.1 Prisma Schemaå®šä¹‰

```prisma
// backend/database/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==================== ç”¨æˆ·ç›¸å…³ ====================

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  username      String?   @unique
  passwordHash  String?   // ç¬¬ä¸‰æ–¹ç™»å½•å¯ä¸ºç©º
  avatar        String?
  phone         String?   @unique
  
  // è®¤è¯ç›¸å…³
  emailVerified Boolean   @default(false)
  phoneVerified Boolean   @default(false)
  
  // ä¸ªäººåå¥½
  preferences   Json?     // { travelStyle, budget, interests }
  
  // OAuth
  googleId      String?   @unique
  githubId      String?   @unique
  wechatId      String?   @unique
  
  // æ—¶é—´æˆ?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  lastLoginAt   DateTime?
  
  // å…³ç³»
  trips         Trip[]
  refreshTokens RefreshToken[]
  
  @@map("users")
}

model RefreshToken {
  id        String   @id @default(uuid())
  token     String   @unique
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt DateTime
  createdAt DateTime @default(now())
  
  @@map("refresh_tokens")
}

// ==================== è¡Œç¨‹ç›¸å…³ ====================

model Trip {
  id            String   @id @default(uuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // åŸºæœ¬ä¿¡æ¯
  title         String
  destination   String
  startDate     DateTime
  endDate       DateTime
  days          Int
  
  // æ—…è¡Œå‚æ•°
  budget        Decimal  @db.Decimal(10, 2)
  travelers     Int      @default(1)
  travelerTypes Json?    // ["æˆäºº", "å„¿ç«¥", "è€äºº"]
  preferences   Json?    // ["ç¾é£Ÿ", "æ–‡åŒ–", "è‡ªç„¶"]
  
  // è¡Œç¨‹å†…å®¹
  overview      Json?    // { summary, highlights, tips }
  dailyPlans    Json     // [{ day, date, theme, activities[] }]
  budgetBreakdown Json?  // { transportation, accommodation, food, ... }
  
  // åœ°å›¾æ•°æ®
  mapCenter     Json?    // { lat, lng }
  
  // çŠ¶æ€?
  status        TripStatus @default(DRAFT)
  isPublic      Boolean    @default(false)
  shareToken    String?    @unique
  
  // ç‰ˆæœ¬æ§åˆ¶
  version       Int        @default(1)
  
  // æ—¶é—´æˆ?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  
  // å…³ç³»
  expenses      Expense[]
  
  @@index([userId, createdAt])
  @@map("trips")
}

enum TripStatus {
  DRAFT      // è‰ç¨¿
  CONFIRMED  // å·²ç¡®è®?
  ONGOING    // è¿›è¡Œä¸?
  COMPLETED  // å·²å®Œæˆ?
  CANCELLED  // å·²å–æ¶?
}

// ==================== è´¹ç”¨ç›¸å…³ ====================

model Expense {
  id          String   @id @default(uuid())
  tripId      String
  trip        Trip     @relation(fields: [tripId], references: [id], onDelete: Cascade)
  
  // è´¹ç”¨ä¿¡æ¯
  category    ExpenseCategory
  amount      Decimal  @db.Decimal(10, 2)
  currency    String   @default("CNY")
  description String?
  
  // æ”¯ä»˜ä¿¡æ¯
  paymentMethod String?  // ç°é‡‘/æ”¯ä»˜å®?å¾®ä¿¡/ä¿¡ç”¨å?
  payer         String?
  
  // å‡­è¯
  receipt       String?  // OSSé“¾æ¥
  
  // æ—¶é—´
  expenseDate   DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([tripId, expenseDate])
  @@map("expenses")
}

enum ExpenseCategory {
  TRANSPORTATION  // äº¤é€?
  ACCOMMODATION   // ä½å®¿
  FOOD            // é¤é¥®
  TICKETS         // é—¨ç¥¨
  SHOPPING        // è´­ç‰©
  ENTERTAINMENT   // å¨±ä¹
  OTHER           // å…¶ä»–
}
```

### 5.2 Redisç¼“å­˜è®¾è®¡

```typescript
// backend/database/redis/cacheKeys.ts

export const CACHE_KEYS = {
  // ç”¨æˆ·ç›¸å…³
  USER_INFO: (userId: string) => `user:${userId}`,
  USER_SESSION: (sessionId: string) => `session:${sessionId}`,
  
  // è¡Œç¨‹ç›¸å…³
  TRIP_DETAIL: (tripId: string) => `trip:${tripId}`,
  USER_TRIPS: (userId: string) => `user:${userId}:trips`,
  
  // APIé™æµ
  RATE_LIMIT: (userId: string, endpoint: string) => 
    `ratelimit:${userId}:${endpoint}`,
  
  // AIç”Ÿæˆç¼“å­˜ï¼ˆç›¸åŒè¾“å…¥è¿”å›ç¼“å­˜ç»“æœï¼‰
  AI_ITINERARY: (hash: string) => `ai:itinerary:${hash}`,
  
  // åœ°å›¾æ•°æ®ç¼“å­˜
  GEO_LOCATION: (address: string) => `geo:${address}`,
  
  // è¿‡æœŸæ—¶é—´é…ç½®
  TTL: {
    USER_INFO: 3600,        // 1å°æ—¶
    TRIP_DETAIL: 1800,      // 30åˆ†é’Ÿ
    AI_ITINERARY: 86400,    // 24å°æ—¶
    GEO_LOCATION: 2592000   // 30å¤?
  }
}
```

---

## å…­ã€APIè®¾è®¡

### 6.1 RESTful APIè§„èŒƒ

**åŸºç¡€URL**ï¼š`https://api.ai-travel-planner.com/v1`

**è®¤è¯æ–¹å¼**ï¼š`Authorization: Bearer <access_token>`

**å“åº”æ ¼å¼**ï¼?
```typescript
// æˆåŠŸå“åº”
{
  "success": true,
  "data": { ... },
  "message": "æ“ä½œæˆåŠŸ",
  "timestamp": 1699334400000
}

// é”™è¯¯å“åº”
{
  "success": false,
  "error": {
    "code": "INVALID_INPUT",
    "message": "è¾“å…¥å‚æ•°æ— æ•ˆ",
    "details": { ... }
  },
  "timestamp": 1699334400000
}
```

### 6.2 APIç«¯ç‚¹æ±‡æ€?

#### è®¤è¯æ¨¡å—
```
POST   /auth/register              # é‚®ç®±æ³¨å†Œ
POST   /auth/login                 # ç™»å½•
POST   /auth/logout                # ç™»å‡º
POST   /auth/refresh               # åˆ·æ–°Token
POST   /auth/forgot-password       # å¿˜è®°å¯†ç 
POST   /auth/reset-password        # é‡ç½®å¯†ç 
GET    /auth/verify-email/:token   # éªŒè¯é‚®ç®±
POST   /auth/oauth/google          # Google OAuth
POST   /auth/oauth/github          # GitHub OAuth
```

#### ç”¨æˆ·æ¨¡å—
```
GET    /users/me                   # è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
PUT    /users/me                   # æ›´æ–°ç”¨æˆ·ä¿¡æ¯
PUT    /users/me/password          # ä¿®æ”¹å¯†ç 
POST   /users/me/avatar            # ä¸Šä¼ å¤´åƒ
GET    /users/me/preferences       # è·å–ç”¨æˆ·åå¥½
PUT    /users/me/preferences       # æ›´æ–°ç”¨æˆ·åå¥½
```

#### è¡Œç¨‹æ¨¡å—
```
GET    /trips                      # è·å–è¡Œç¨‹åˆ—è¡¨
POST   /trips                      # åˆ›å»ºè¡Œç¨‹
GET    /trips/:id                  # è·å–è¡Œç¨‹è¯¦æƒ…
PUT    /trips/:id                  # æ›´æ–°è¡Œç¨‹
DELETE /trips/:id                  # åˆ é™¤è¡Œç¨‹
PATCH  /trips/:id/status           # æ›´æ–°è¡Œç¨‹çŠ¶æ€?

POST   /trips/generate             # AIç”Ÿæˆè¡Œç¨‹
POST   /trips/:id/duplicate        # å¤åˆ¶è¡Œç¨‹
POST   /trips/:id/share            # ç”Ÿæˆåˆ†äº«é“¾æ¥
GET    /trips/shared/:token        # è®¿é—®åˆ†äº«è¡Œç¨‹
POST   /trips/:id/export           # å¯¼å‡ºPDF
```

#### è´¹ç”¨æ¨¡å—
```
GET    /trips/:tripId/expenses     # è·å–è´¹ç”¨åˆ—è¡¨
POST   /trips/:tripId/expenses     # æ·»åŠ è´¹ç”¨è®°å½•
GET    /expenses/:id               # è·å–è´¹ç”¨è¯¦æƒ…
PUT    /expenses/:id               # æ›´æ–°è´¹ç”¨è®°å½•
DELETE /expenses/:id               # åˆ é™¤è´¹ç”¨è®°å½•

GET    /trips/:tripId/budget-analysis  # é¢„ç®—åˆ†æ
POST   /expenses/voice-parse       # è¯­éŸ³è§£æè´¹ç”¨
POST   /expenses/ocr               # OCRè¯†åˆ«å°ç¥¨
```

#### è¯­éŸ³æ¨¡å—
```
POST   /voice/recognize            # è¯­éŸ³è¯†åˆ«
WS     /voice/stream               # å®æ—¶è¯­éŸ³æµï¼ˆWebSocketï¼?
```

#### åœ°å›¾æ¨¡å—
```
POST   /map/geocode                # åœ°ç†ç¼–ç 
POST   /map/directions             # è·¯çº¿è§„åˆ’
GET    /map/places/search          # POIæœç´¢
```

### 6.3 WebSocketäº‹ä»¶

```typescript
// å®¢æˆ·ç«?â†?æœåŠ¡å™?
{
  "voice:start": {},                // å¼€å§‹è¯­éŸ³è¯†åˆ?
  "voice:data": { audio: Blob },    // éŸ³é¢‘æ•°æ®æµ?
  "voice:end": {},                  // ç»“æŸè¯­éŸ³è¯†åˆ«
  
  "trip:subscribe": { tripId },     // è®¢é˜…è¡Œç¨‹æ›´æ–°
  "trip:unsubscribe": { tripId },   // å–æ¶ˆè®¢é˜…
  "trip:edit": { tripId, changes }  // ç¼–è¾‘è¡Œç¨‹ï¼ˆåä½œï¼‰
}

// æœåŠ¡å™?â†?å®¢æˆ·ç«?
{
  "voice:result": { text, final },  // è¯†åˆ«ç»“æœ
  "voice:error": { message },       // è¯†åˆ«é”™è¯¯
  
  "trip:updated": { tripId, data }, // è¡Œç¨‹å·²æ›´æ–?
  "trip:user-join": { userId },     // ç”¨æˆ·åŠ å…¥åä½œ
  "trip:user-leave": { userId }     // ç”¨æˆ·ç¦»å¼€åä½œ
}
```

---

## ä¸ƒã€éƒ¨ç½²æ¶æ?

### 7.1 Dockerå®¹å™¨æ¶æ„

```yaml
# docker-compose.yml

version: '3.8'

services:
  # å‰ç«¯æœåŠ¡
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: ai-travel-frontend
    ports:
      - "80:80"
      - "443:443"
    depends_on:
      - backend
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./nginx/ssl:/etc/nginx/ssl
    restart: unless-stopped
    networks:
      - app-network

  # åç«¯æœåŠ¡
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: ai-travel-backend
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_URL=${REDIS_URL}
      - JWT_SECRET=${JWT_SECRET}
      - DASHSCOPE_API_KEY=${DASHSCOPE_API_KEY}
      - AMAP_KEY=${AMAP_KEY}
    depends_on:
      - postgres
      - redis
    volumes:
      - ./logs:/app/logs
    restart: unless-stopped
    networks:
      - app-network

  # PostgreSQLæ•°æ®åº?
  postgres:
    image: postgres:15-alpine
    container_name: ai-travel-postgres
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_DB=ai_travel_planner
      - POSTGRES_USER=${DB_USER}
      - POSTGRES_PASSWORD=${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./backend/database/init.sql:/docker-entrypoint-initdb.d/init.sql
    restart: unless-stopped
    networks:
      - app-network

  # Redisç¼“å­˜
  redis:
    image: redis:7-alpine
    container_name: ai-travel-redis
    ports:
      - "6379:6379"
    command: redis-server --appendonly yes --requirepass ${REDIS_PASSWORD}
    volumes:
      - redis_data:/data
    restart: unless-stopped
    networks:
      - app-network

  # Nginxï¼ˆå¯é€‰ï¼Œç”¨äºè´Ÿè½½å‡è¡¡ï¼?
  nginx:
    image: nginx:alpine
    container_name: ai-travel-nginx
    ports:
      - "8080:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - backend
    restart: unless-stopped
    networks:
      - app-network

volumes:
  postgres_data:
  redis_data:

networks:
  app-network:
    driver: bridge
```

### 7.2 CI/CDæµç¨‹

```yaml
# .github/workflows/deploy.yml

name: Build and Deploy

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'
      
      - name: Install Dependencies
        run: |
          cd frontend && npm ci
          cd ../backend && npm ci
      
      - name: Run Tests
        run: |
          cd frontend && npm test
          cd ../backend && npm test
      
      - name: Lint
        run: |
          cd frontend && npm run lint
          cd ../backend && npm run lint

  build-and-push:
    needs: test
    runs-on: ubuntu-latest
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Login to Aliyun Container Registry
        uses: docker/login-action@v2
        with:
          registry: registry.cn-hangzhou.aliyuncs.com
          username: ${{ secrets.ALIYUN_USERNAME }}
          password: ${{ secrets.ALIYUN_PASSWORD }}
      
      - name: Build and Push Frontend
        run: |
          docker build -t registry.cn-hangzhou.aliyuncs.com/your-namespace/ai-travel-frontend:latest ./frontend
          docker push registry.cn-hangzhou.aliyuncs.com/your-namespace/ai-travel-frontend:latest
      
      - name: Build and Push Backend
        run: |
          docker build -t registry.cn-hangzhou.aliyuncs.com/your-namespace/ai-travel-backend:latest ./backend
          docker push registry.cn-hangzhou.aliyuncs.com/your-namespace/ai-travel-backend:latest

  deploy:
    needs: build-and-push
    runs-on: ubuntu-latest
    
    steps:
      - name: Deploy to Server
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            cd /opt/ai-travel-planner
            docker-compose pull
            docker-compose up -d
            docker system prune -f
```

### 7.3 éƒ¨ç½²æ‹“æ‰‘å›?

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
                    â”?  ç”¨æˆ·è®¾å¤‡   â”?
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”?
                           â”?
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”?
                    â”?  CDN/DNS   â”?
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”?
                           â”?
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
        â”?        é˜¿é‡Œäº?AWS/è…¾è®¯äº?            â”?
        â”?                                     â”?
        â”? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”? â”?
        â”? â”? è´Ÿè½½å‡è¡¡   â”?   â”?  Docker    â”? â”?
        â”? â”? (SLB)    â”‚â”€â”€â”€â–¶â”‚   Swarm     â”? â”?
        â”? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”? â”?
        â”?                          â”?        â”?
        â”? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”? â”?
        â”? â”‚Frontendâ”‚Backend â”? Backend   â”? â”?
        â”? â”?Node 1 â”?Node 1 â”? Node 2    â”? â”?
        â”? â””â”€â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”? â”?
        â”?      â”?      â”?        â”?         â”?
        â”? â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”? â”?
        â”? â”?     PostgreSQLé›†ç¾¤          â”? â”?
        â”? â”?   (ä¸»ä» + Supabase)         â”? â”?
        â”? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”? â”?
        â”?                                    â”?
        â”? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”? â”?
        â”? â”?       Redisé›†ç¾¤              â”? â”?
        â”? â”?   (å“¨å…µæ¨¡å¼/é›†ç¾¤æ¨¡å¼)         â”? â”?
        â”? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”? â”?
        â”?                                    â”?
        â”? â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”? â”?
        â”? â”?     å¯¹è±¡å­˜å‚¨ (OSS)           â”? â”?
        â”? â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”? â”?
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”?
```

---

## å…«ã€å¼€å‘å·¥å…·é“¾

### 8.1 å¿…å¤‡å·¥å…·

| å·¥å…· | ç”¨é€?| ç‰ˆæœ¬ |
|------|------|------|
| **Node.js** | JavaScriptè¿è¡Œæ—?| 20 LTS |
| **npm/pnpm** | åŒ…ç®¡ç†å™¨ | 9+ / 8+ |
| **Git** | ç‰ˆæœ¬æ§åˆ¶ | 2.40+ |
| **Docker** | å®¹å™¨åŒ?| 24+ |
| **Docker Compose** | å®¹å™¨ç¼–æ’ | 2.20+ |
| **VS Code** | ä»£ç ç¼–è¾‘å™?| æœ€æ–°ç‰ˆ |
| **Postman** | APIæµ‹è¯• | æœ€æ–°ç‰ˆ |

### 8.2 VS Codeæ¨èæ’ä»¶

```json
{
  "recommendations": [
    "dbaeumer.vscode-eslint",
    "esbenp.prettier-vscode",
    "prisma.prisma",
    "ms-vscode.vscode-typescript-next",
    "bradlc.vscode-tailwindcss",
    "christian-kohler.path-intellisense",
    "usernamehw.errorlens",
    "eamodio.gitlens",
    "ms-azuretools.vscode-docker",
    "humao.rest-client"
  ]
}
```

### 8.3 å¼€å‘è„šæœ?

```json
// package.json scripts
{
  "scripts": {
    // å¼€å?
    "dev": "concurrently \"npm run dev:frontend\" \"npm run dev:backend\"",
    "dev:frontend": "cd frontend && npm run dev",
    "dev:backend": "cd backend && npm run dev",
    
    // æ„å»º
    "build": "npm run build:frontend && npm run build:backend",
    "build:frontend": "cd frontend && npm run build",
    "build:backend": "cd backend && npm run build",
    
    // æµ‹è¯•
    "test": "npm run test:frontend && npm run test:backend",
    "test:frontend": "cd frontend && npm test",
    "test:backend": "cd backend && npm test",
    
    // æ•°æ®åº?
    "db:migrate": "cd backend && npx prisma migrate dev",
    "db:seed": "cd backend && npx prisma db seed",
    "db:studio": "cd backend && npx prisma studio",
    
    // Docker
    "docker:build": "docker-compose build",
    "docker:up": "docker-compose up -d",
    "docker:down": "docker-compose down",
    "docker:logs": "docker-compose logs -f",
    
    // ä»£ç è´¨é‡
    "lint": "npm run lint:frontend && npm run lint:backend",
    "lint:fix": "npm run lint:frontend -- --fix && npm run lint:backend -- --fix",
    "format": "prettier --write \"**/*.{ts,tsx,js,jsx,json,css,md}\"",
    
    // éƒ¨ç½²
    "deploy": "sh scripts/deploy.sh"
  }
}
```

---

## ä¹ã€å¼€å‘æµç¨‹è§„èŒ?

### 9.1 Gitå·¥ä½œæµ?

```bash
# åˆ†æ”¯ç­–ç•¥
main          # ç”Ÿäº§ç¯å¢ƒåˆ†æ”¯
develop       # å¼€å‘ç¯å¢ƒåˆ†æ”?
feature/*     # åŠŸèƒ½åˆ†æ”¯
bugfix/*      # Bugä¿®å¤åˆ†æ”¯
hotfix/*      # ç´§æ€¥ä¿®å¤åˆ†æ”?

# Commitè§„èŒƒï¼ˆConventional Commitsï¼?
feat: æ–°åŠŸèƒ?
fix: Bugä¿®å¤
docs: æ–‡æ¡£æ›´æ–°
style: ä»£ç æ ¼å¼
refactor: é‡æ„
test: æµ‹è¯•
chore: æ„å»º/å·¥å…·

# ç¤ºä¾‹
git commit -m "feat: å®ç°è¯­éŸ³è¯†åˆ«åŠŸèƒ½"
git commit -m "fix: ä¿®å¤åœ°å›¾æ ‡è®°æ˜¾ç¤ºbug"
```

### 9.2 ä»£ç å®¡æŸ¥æ¸…å•

- [ ] ä»£ç ç¬¦åˆESLintè§„èŒƒ
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ·»åŠ äº†å¿…è¦çš„æ³¨é‡Š
- [ ] æ›´æ–°äº†ç›¸å…³æ–‡æ¡?
- [ ] æ²¡æœ‰console.logç­‰è°ƒè¯•ä»£ç ?
- [ ] æ•æ„Ÿä¿¡æ¯æ²¡æœ‰ç¡¬ç¼–ç ?
- [ ] API Keyæ­£ç¡®ç®¡ç†
- [ ] æ€§èƒ½å½±å“è¯„ä¼°

---

## åã€æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ

### 10.1 å‰ç«¯ä¼˜åŒ–

| ä¼˜åŒ–ç‚?| æ–¹æ¡ˆ | å·¥å…·/æŠ€æœ?|
|--------|------|----------|
| **ä»£ç åˆ†å‰²** | è·¯ç”±æ‡’åŠ è½½ã€åŠ¨æ€å¯¼å…?| React.lazy, Suspense |
| **èµ„æºä¼˜åŒ–** | å›¾ç‰‡å‹ç¼©ã€WebPæ ¼å¼ | tinypng, imagemin |
| **ç¼“å­˜ç­–ç•¥** | Service Workerã€CDN | Workbox |
| **æ‰“åŒ…ä¼˜åŒ–** | Tree Shakingã€å‹ç¼?| Vite, Terser |
| **é¦–å±åŠ è½½** | SSRã€é¢„æ¸²æŸ“ | Next.js |
| **éª¨æ¶å±?* | åŠ è½½å ä½ | React Content Loader |

### 10.2 åç«¯ä¼˜åŒ–

| ä¼˜åŒ–ç‚?| æ–¹æ¡ˆ | å·¥å…·/æŠ€æœ?|
|--------|------|----------|
| **æ•°æ®åº“æŸ¥è¯?* | ç´¢å¼•ä¼˜åŒ–ã€è¿æ¥æ±  | Prisma, pg-pool |
| **ç¼“å­˜** | Rediså¤šçº§ç¼“å­˜ | ioredis |
| **APIé™æµ** | Token Bucket | express-rate-limit |
| **å¹¶å‘å¤„ç†** | Worker Threads | Node.js Cluster |
| **æ—¥å¿—** | å¼‚æ­¥æ—¥å¿— | Winston |

---

## åä¸€ã€ç›‘æ§ä¸è¿ç»´

### 11.1 ç›‘æ§æŒ‡æ ‡

```typescript
// å…³é”®æŒ‡æ ‡
{
  "æ€§èƒ½æŒ‡æ ‡": {
    "APIå“åº”æ—¶é—´": "< 500ms",
    "é¡µé¢åŠ è½½æ—¶é—´": "< 2s",
    "AIç”Ÿæˆæ—¶é—´": "< 10s"
  },
  "å¯ç”¨æ€§æŒ‡æ ?: {
    "ç³»ç»Ÿå¯ç”¨ç?: "> 99.5%",
    "é”™è¯¯ç?: "< 0.1%"
  },
  "ä¸šåŠ¡æŒ‡æ ‡": {
    "æ—¥æ´»ç”¨æˆ·": "DAU",
    "è¡Œç¨‹ç”ŸæˆæˆåŠŸç?: "> 95%",
    "ç”¨æˆ·ç•™å­˜ç?: "D1, D7, D30"
  }
}
```

### 11.2 æ—¥å¿—è§„èŒƒ

```typescript
// backend/utils/logger.ts
import winston from 'winston'

export const logger = winston.createLogger({
  level: 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.json()
  ),
  transports: [
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' })
  ]
})

// æ—¥å¿—åˆ†ç±»
logger.info('ç”¨æˆ·ç™»å½•', { userId, ip, timestamp })
logger.error('AIç”Ÿæˆå¤±è´¥', { error, input, timestamp })
logger.warn('APIè°ƒç”¨è¶…é™', { userId, endpoint, timestamp })
```

---

## åäºŒã€å®‰å…¨æ–¹æ¡?

### 12.1 å®‰å…¨æªæ–½æ¸…å•

- [x] HTTPSåŠ å¯†ä¼ è¾“
- [x] JWT Tokenè®¤è¯
- [x] å¯†ç bcryptåŠ å¯†
- [x] SQLæ³¨å…¥é˜²æŠ¤ï¼ˆPrismaå‚æ•°åŒ–ï¼‰
- [x] XSSé˜²æŠ¤ï¼ˆDOMPurifyï¼?
- [x] CSRFé˜²æŠ¤ï¼ˆCSRF Tokenï¼?
- [x] APIé™æµ
- [x] æ•æ„Ÿæ•°æ®è„±æ•
- [x] å®šæœŸå®‰å…¨å®¡è®¡

### 12.2 ç¯å¢ƒå˜é‡ç®¡ç†

```bash
# .env.example

# === åº”ç”¨é…ç½® ===
NODE_ENV=development
PORT=3000
CLIENT_URL=http://localhost:5173

# === æ•°æ®åº?===
DATABASE_URL=postgresql://user:pass@localhost:5432/ai_travel_planner
REDIS_URL=redis://:password@localhost:6379

# === JWT ===
JWT_SECRET=your-256-bit-secret
JWT_EXPIRES_IN=15m
REFRESH_TOKEN_EXPIRES_IN=7d

# === AIæœåŠ¡ ===
# é˜¿é‡Œäº‘é€šä¹‰åƒé—®
DASHSCOPE_API_KEY=sk-xxxxxxxxxxxx
DASHSCOPE_API_URL=https://dashscope.aliyuncs.com

# === åœ°å›¾æœåŠ¡ ===
AMAP_KEY=your-amap-key
AMAP_SECRET=your-amap-secret

# === è¯­éŸ³è¯†åˆ« ===
XUNFEI_APP_ID=your-app-id
XUNFEI_API_KEY=your-api-key
XUNFEI_API_SECRET=your-api-secret

# === å¯¹è±¡å­˜å‚¨ ===
OSS_ACCESS_KEY_ID=your-access-key-id
OSS_ACCESS_KEY_SECRET=your-access-key-secret
OSS_BUCKET=ai-travel-planner
OSS_REGION=oss-cn-hangzhou

# === é‚®ä»¶æœåŠ¡ ===
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USER=your-email@example.com
SMTP_PASSWORD=your-password

# === çŸ­ä¿¡æœåŠ¡ ===
SMS_ACCESS_KEY_ID=your-key
SMS_ACCESS_KEY_SECRET=your-secret
SMS_SIGN_NAME=AIæ—…è¡Œè§„åˆ’å¸?
```

---

## é™„å½•

### A. æŠ€æœ¯é€‰å‹å¯¹æ¯”è¡?

| å¯¹æ¯”é¡?| React | Vue |
|--------|-------|-----|
| å­¦ä¹ æ›²çº¿ | ä¸­ç­‰ | è¾ƒä½ |
| ç”Ÿæ€ç³»ç»?| â­â­â­â­â­?| â­â­â­â­ |
| æ€§èƒ½ | ä¼˜ç§€ | ä¼˜ç§€ |
| TypeScriptæ”¯æŒ | ä¼˜ç§€ | è‰¯å¥½ |
| ç¤¾åŒºæ´»è·ƒåº?| æé«˜ | é«?|
| æ¨èåº?| âœ?æ¨è | âœ?æ¨è |

| å¯¹æ¯”é¡?| Node.js | Python |
|--------|---------|--------|
| æ€§èƒ½ | é«˜ï¼ˆå¼‚æ­¥IOï¼?| ä¸?|
| å¼€å‘æ•ˆç?| é«?| æé«˜ |
| AIé›†æˆ | è‰¯å¥½ | ä¼˜ç§€ |
| æŠ€æœ¯æ ˆç»Ÿä¸€ | âœ?| â?|
| æ¨èåº?| âœ?æ¨è | âœ?æ¨è |

### B. ç¬¬ä¸‰æ–¹æœåŠ¡å®šä»·å‚è€?

| æœåŠ¡ | å…è´¹é¢åº¦ | ä»˜è´¹ä»·æ ¼ |
|------|---------|---------|
| **é˜¿é‡Œäº‘é€šä¹‰åƒé—®** | æ—?| Â¥0.008/1K tokens |
| **é«˜å¾·åœ°å›¾API** | 10ä¸‡æ¬¡/æ—?| è¶…å‡ºéƒ¨åˆ†è®¡è´¹ |
| **ç§‘å¤§è®¯é£è¯­éŸ³** | 5ä¸‡æ¬¡/æ—?| æŒ‰è°ƒç”¨é‡è®¡è´¹ |
| **Supabase** | 500MB DB, 1GBå­˜å‚¨ | $25/æœˆèµ· |
| **é˜¿é‡Œäº‘OSS** | æ—?| Â¥0.12/GB/æœ?|

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**æœ€åæ›´æ–?*ï¼?025-11-07  
**ç»´æŠ¤è€?*ï¼šå¼€å‘å›¢é˜?


