# ç”¨æˆ·è®¤è¯åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## âœ?å·²å®Œæˆçš„åŠŸèƒ½

### 1. æ ¸å¿ƒè®¤è¯åŠŸèƒ½

#### è®¤è¯ API (`frontend/src/api/auth.api.ts`)
- âœ?**é‚®ç®±æ³¨å†Œ** - `signUpWithEmail(email, password, username)`
- âœ?**é‚®ç®±ç™»å½•** - `signInWithEmail(email, password)`
- âœ?**é€€å‡ºç™»å½?* - `signOut()`
- âœ?**è·å–å½“å‰ç”¨æˆ·** - `getCurrentUser()`
- âœ?**è·å–å½“å‰ä¼šè¯** - `getCurrentSession()`
- âœ?**é‡ç½®å¯†ç ** - `resetPasswordForEmail(email)`
- âœ?**æ›´æ–°å¯†ç ** - `updatePassword(newPassword)`
- âœ?**æ›´æ–°ç”¨æˆ·èµ„æ–™** - `updateProfile(updates)`
- âœ?**è·å–ç”¨æˆ·èµ„æ–™** - `getProfile(userId)`
- âœ?**OAuthç™»å½•** - `signInWithGoogle()`, `signInWithGithub()`
- âœ?**ç›‘å¬è®¤è¯çŠ¶æ€å˜åŒ?* - `onAuthStateChange(callback)`

#### React Hook (`frontend/src/hooks/useAuth.ts`)
- âœ?è‡ªåŠ¨ç›‘å¬ç”¨æˆ·ç™»å½•çŠ¶æ€?
- âœ?è‡ªåŠ¨åŠ è½½ç”¨æˆ·èµ„æ–™
- âœ?æä¾›è®¤è¯çŠ¶æ€ï¼š`user`, `session`, `profile`, `loading`, `isAuthenticated`

#### çŠ¶æ€ç®¡ç?(`frontend/src/store/authStore.ts`)
- âœ?Zustand å…¨å±€çŠ¶æ€ç®¡ç?
- âœ?æŒä¹…åŒ–å­˜å‚¨ï¼ˆLocalStorageï¼?
- âœ?ç™»å½•/æ³¨å†Œ/ç™»å‡ºæ“ä½œ
- âœ?åˆ·æ–°è®¤è¯çŠ¶æ€?
- âœ?é”™è¯¯å¤„ç†

### 2. ç”¨æˆ·ç•Œé¢

#### ç™»å½•é¡µé¢ (`frontend/src/pages/Auth/Login.tsx`)
- âœ?é‚®ç®±å’Œå¯†ç ç™»å½?
- âœ?è¡¨å•éªŒè¯ï¼ˆé‚®ç®±æ ¼å¼ã€å¯†ç é•¿åº¦ï¼‰
- âœ?é”™è¯¯æç¤º
- âœ?åŠ è½½çŠ¶æ€?
- âœ?å¿˜è®°å¯†ç é“¾æ¥
- âœ?æ³¨å†Œé¡µé¢é“¾æ¥
- âœ?OAuth ç™»å½•æŒ‰é’®ï¼ˆé¢„ç•™ï¼‰

#### æ³¨å†Œé¡µé¢ (`frontend/src/pages/Auth/Register.tsx`)
- âœ?ç”¨æˆ·åã€é‚®ç®±ã€å¯†ç æ³¨å†?
- âœ?è¡¨å•éªŒè¯
  - ç”¨æˆ·åï¼š2-20ä¸ªå­—ç¬?
  - é‚®ç®±ï¼šæœ‰æ•ˆæ ¼å¼?
  - å¯†ç ï¼šè‡³å°?ä½ï¼ŒåŒ…å«å­—æ¯å’Œæ•°å­?
  - ç¡®è®¤å¯†ç ï¼šä¸¤æ¬¡è¾“å…¥ä¸€è‡?
- âœ?é”™è¯¯æç¤º
- âœ?åŠ è½½çŠ¶æ€?
- âœ?æœåŠ¡æ¡æ¬¾å’Œéšç§æ”¿ç­–å‹¾é€?
- âœ?ç™»å½•é¡µé¢é“¾æ¥
- âœ?OAuth æ³¨å†ŒæŒ‰é’®ï¼ˆé¢„ç•™ï¼‰

#### æ ·å¼è®¾è®¡ (`frontend/src/pages/Auth/Auth.css`)
- âœ?ç°ä»£åŒ–æ¸å˜èƒŒæ™?
- âœ?å¡ç‰‡å¼å¸ƒå±€
- âœ?åŠ¨ç”»æ•ˆæœ
- âœ?å“åº”å¼è®¾è®?
- âœ?é”™è¯¯å’ŒæˆåŠŸçŠ¶æ€æ ·å¼?
- âœ?åŠ è½½çŠ¶æ€æ ·å¼?

### 3. è·¯ç”±é…ç½®

#### è·¯ç”±å®ˆå« (`frontend/src/router.tsx`)
- âœ?**å—ä¿æŠ¤è·¯ç”?* - æœªç™»å½•ç”¨æˆ·è‡ªåŠ¨é‡å®šå‘åˆ°ç™»å½•é¡µ
  - `/dashboard` - ä»ªè¡¨æ?
  - `/trip/create` - åˆ›å»ºè¡Œç¨‹
  - `/trip/:id` - è¡Œç¨‹è¯¦æƒ…
  - `/expense` - è´¹ç”¨ç®¡ç†
  - `/profile` - ä¸ªäººä¸­å¿ƒ
  - `/settings` - è®¾ç½®
- âœ?**å…¬å¼€è·¯ç”±** - å·²ç™»å½•ç”¨æˆ·è‡ªåŠ¨é‡å®šå‘åˆ°é¦–é¡?
  - `/login` - ç™»å½•é¡?
  - `/register` - æ³¨å†Œé¡?
- âœ?åŠ è½½çŠ¶æ€å¤„ç?
- âœ?404 é¡µé¢

---

## ğŸ“‹ ä½¿ç”¨æ­¥éª¤

### 1. é…ç½®ç¯å¢ƒå˜é‡

åœ?`frontend` ç›®å½•ä¸‹åˆ›å»?`.env.local` æ–‡ä»¶ï¼?

```bash
# å¤åˆ¶ç¤ºä¾‹æ–‡ä»¶
cp .env.example .env.local

# ç¼–è¾‘æ–‡ä»¶ï¼Œå¡«å…¥æ‚¨çš?Supabase é…ç½®
# VITE_SUPABASE_URL å’?VITE_SUPABASE_ANON_KEY
```

ä»?Supabase Dashboard è·å–é…ç½®ï¼?
1. ç™»å½• [Supabase](https://supabase.com)
2. è¿›å…¥æ‚¨çš„é¡¹ç›®
3. ç‚¹å‡» Settings â†?API
4. å¤åˆ¶ `Project URL` å’?`anon public` key

### 2. å®‰è£…ä¾èµ–

```bash
cd frontend
npm install
```

ç¡®ä¿ä»¥ä¸‹ä¾èµ–å·²å®‰è£…ï¼š
- `@supabase/supabase-js` - Supabase å®¢æˆ·ç«?
- `zustand` - çŠ¶æ€ç®¡ç?
- `react-router-dom` - è·¯ç”±

### 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

åº”ç”¨å°†åœ¨ `http://localhost:5173` å¯åŠ¨

---

## ğŸ¯ åŠŸèƒ½æµ‹è¯•

### æµ‹è¯•æ³¨å†ŒåŠŸèƒ½

1. è®¿é—® `http://localhost:5173/register`
2. å¡«å†™è¡¨å•ï¼?
   - ç”¨æˆ·åï¼šè‡³å°‘ 2 ä¸ªå­—ç¬?
   - é‚®ç®±ï¼šæœ‰æ•ˆçš„é‚®ç®±åœ°å€
   - å¯†ç ï¼šè‡³å°?6 ä½ï¼ŒåŒ…å«å­—æ¯å’Œæ•°å­?
   - ç¡®è®¤å¯†ç ï¼šä¸å¯†ç ä¸€è‡?
3. å‹¾é€?åŒæ„æœåŠ¡æ¡æ¬¾"
4. ç‚¹å‡»"æ³¨å†Œ"æŒ‰é’®
5. æ³¨å†ŒæˆåŠŸåä¼šæ”¶åˆ°éªŒè¯é‚®ä»¶ï¼ˆæ£€æŸ¥é‚®ç®±ï¼‰
6. ç‚¹å‡»é‚®ä»¶ä¸­çš„é“¾æ¥éªŒè¯è´¦æˆ·
7. è¿”å›ç™»å½•é¡µé¢ç™»å½•

### æµ‹è¯•ç™»å½•åŠŸèƒ½

1. è®¿é—® `http://localhost:5173/login`
2. è¾“å…¥é‚®ç®±å’Œå¯†ç ?
3. ç‚¹å‡»"ç™»å½•"æŒ‰é’®
4. ç™»å½•æˆåŠŸåè‡ªåŠ¨è·³è½¬åˆ°é¦–é¡µ
5. ç”¨æˆ·ä¿¡æ¯ä¼šä¿å­˜åœ¨ LocalStorage ä¸?

### æµ‹è¯•è·¯ç”±å®ˆå«

1. æœªç™»å½•æ—¶è®¿é—® `/dashboard` â†?è‡ªåŠ¨é‡å®šå‘åˆ° `/login`
2. å·²ç™»å½•æ—¶è®¿é—® `/login` â†?è‡ªåŠ¨é‡å®šå‘åˆ° `/`
3. ç™»å‡ºåè‡ªåŠ¨é‡å®šå‘åˆ°ç™»å½•é¡µ

### æµ‹è¯•ç™»å‡ºåŠŸèƒ½

åœ¨ä»»ä½•å—ä¿æŠ¤çš„é¡µé¢ä¸­ï¼?
```typescript
import { useAuthStore } from '@/store/authStore'

const { signOut } = useAuthStore()

// è°ƒç”¨ç™»å‡º
await signOut()
```

---

## ğŸ’» ä»£ç ä½¿ç”¨ç¤ºä¾‹

### åœ¨ç»„ä»¶ä¸­ä½¿ç”¨è®¤è¯çŠ¶æ€?

#### æ–¹å¼1ï¼šä½¿ç”?Hook

```tsx
import { useAuth } from '@/hooks/useAuth'

function MyComponent() {
  const { user, profile, loading, isAuthenticated } = useAuth()

  if (loading) {
    return <div>åŠ è½½ä¸?..</div>
  }

  if (!isAuthenticated) {
    return <div>è¯·å…ˆç™»å½•</div>
  }

  return (
    <div>
      <h1>æ¬¢è¿ï¼Œ{profile?.username || user?.email}</h1>
      <p>ç”¨æˆ·ID: {user?.id}</p>
    </div>
  )
}
```

#### æ–¹å¼2ï¼šä½¿ç”?Store

```tsx
import { useAuthStore } from '@/store/authStore'

function MyComponent() {
  const { user, profile, signOut } = useAuthStore()

  const handleLogout = async () => {
    try {
      await signOut()
      alert('ç™»å‡ºæˆåŠŸ')
    } catch (error) {
      console.error('ç™»å‡ºå¤±è´¥:', error)
    }
  }

  return (
    <div>
      <h1>æ¬¢è¿ï¼Œ{profile?.username}</h1>
      <button onClick={handleLogout}>é€€å‡ºç™»å½?/button>
    </div>
  )
}
```

### æ‰‹åŠ¨è°ƒç”¨è®¤è¯ API

```tsx
import {
  signInWithEmail,
  signUpWithEmail,
  signOut,
  resetPasswordForEmail
} from '@/api/auth.api'

// ç™»å½•
try {
  const { user, session } = await signInWithEmail(
    'user@example.com',
    'password123'
  )
  console.log('ç™»å½•æˆåŠŸ:', user)
} catch (error) {
  console.error('ç™»å½•å¤±è´¥:', error)
}

// æ³¨å†Œ
try {
  const { user } = await signUpWithEmail(
    'user@example.com',
    'password123',
    'username'
  )
  console.log('æ³¨å†ŒæˆåŠŸ:', user)
} catch (error) {
  console.error('æ³¨å†Œå¤±è´¥:', error)
}

// é‡ç½®å¯†ç 
try {
  await resetPasswordForEmail('user@example.com')
  alert('é‡ç½®å¯†ç é‚®ä»¶å·²å‘é€?)
} catch (error) {
  console.error('å‘é€å¤±è´?', error)
}
```

---

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

### 1. ç¯å¢ƒå˜é‡å®‰å…¨
- âœ?`.env.local` å·²åœ¨ `.gitignore` ä¸­ï¼Œä¸ä¼šæäº¤åˆ?Git
- âœ?åªä½¿ç”?`anon_key`ï¼Œä¸è¦åœ¨å‰ç«¯ä½¿ç”¨ `service_role` key
- âœ?Supabase RLS å·²å¯ç”¨ï¼Œç¡®ä¿æ•°æ®å®‰å…¨

### 2. å¯†ç ç­–ç•¥
- âœ?æœ€å°?6 ä½?
- âœ?å¿…é¡»åŒ…å«å­—æ¯å’Œæ•°å­?
- å»ºè®®ï¼šæ·»åŠ ç‰¹æ®Šå­—ç¬¦è¦æ±‚ï¼ˆå¯é€‰ï¼‰

### 3. è¡¨å•éªŒè¯
- âœ?å‰ç«¯éªŒè¯ï¼ˆç”¨æˆ·ä½“éªŒï¼‰
- âœ?åç«¯éªŒè¯ï¼ˆSupabase è‡ªåŠ¨å¤„ç†ï¼?

### 4. ä¼šè¯ç®¡ç†
- âœ?è‡ªåŠ¨åˆ·æ–° Token
- âœ?æŒä¹…åŒ–ä¼šè¯ï¼ˆLocalStorageï¼?
- âœ?è‡ªåŠ¨æ£€æµ‹ä¼šè¯è¿‡æœ?

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æ³¨å†Œåæ— æ³•ç™»å½•ï¼Ÿ
**A:** æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²éªŒè¯ã€‚Supabase é»˜è®¤éœ€è¦é‚®ç®±éªŒè¯ã€?

**è§£å†³æ–¹æ¡ˆï¼?*
1. æ£€æŸ¥é‚®ç®±ï¼ˆåŒ…æ‹¬åƒåœ¾ç®±ï¼‰
2. ç‚¹å‡»éªŒè¯é“¾æ¥
3. æˆ–åœ¨ Supabase Dashboard â†?Authentication â†?Policies ä¸­ç¦ç”¨é‚®ç®±éªŒè¯?

### Q2: ç™»å½•åç«‹å³é€€å‡ºç™»å½•ï¼Ÿ
**A:** æ£€æŸ¥æ˜¯å¦å¯ç”¨äº†é‚®ç®±éªŒè¯ä½†æœªéªŒè¯é‚®ç®±ã€?

**è§£å†³æ–¹æ¡ˆï¼?*
```typescript
// åœ?signIn åæ£€æŸ¥ç”¨æˆ·çŠ¶æ€?
const { user } = await signInWithEmail(email, password)
if (user && !user.email_confirmed_at) {
  alert('è¯·å…ˆéªŒè¯æ‚¨çš„é‚®ç®±')
}
```

### Q3: è·¯ç”±å®ˆå«ä¸å·¥ä½œï¼Ÿ
**A:** ç¡®ä¿ `refreshAuth()` åœ?App å¯åŠ¨æ—¶è¢«è°ƒç”¨ã€?

**æ£€æŸ¥ï¼š**
```tsx
// App.tsx
useEffect(() => {
  refreshAuth() // å¿…é¡»è°ƒç”¨
}, [refreshAuth])
```

### Q4: ç”¨æˆ·èµ„æ–™ä¸ºç©ºï¼?
**A:** æ–°æ³¨å†Œç”¨æˆ·çš„ profile ç”±æ•°æ®åº“è§¦å‘å™¨è‡ªåŠ¨åˆ›å»ºï¼Œå¯èƒ½æœ‰å»¶è¿Ÿã€?

**è§£å†³æ–¹æ¡ˆï¼?*
```typescript
// åœ¨æ³¨å†Œåæ‰‹åŠ¨åˆ›å»ºèµ„æ–™
await signUp(email, password, username)
// ç­‰å¾…ä¸€ä¸?
await new Promise(resolve => setTimeout(resolve, 1000))
await refreshAuth()
```

### Q5: OAuth ç™»å½•ä¸å·¥ä½œï¼Ÿ
**A:** OAuth éœ€è¦åœ¨ Supabase Dashboard ä¸­é…ç½®ã€?

**é…ç½®æ­¥éª¤ï¼?*
1. Supabase Dashboard â†?Authentication â†?Providers
2. å¯ç”¨ Google/GitHub
3. é…ç½® OAuth å‡­è¯
4. è®¾ç½®å›è°ƒ URLï¼š`http://localhost:5173/auth/callback`

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Supabase è®¤è¯æ–‡æ¡£](https://supabase.com/docs/guides/auth)
- [React Router æ–‡æ¡£](https://reactrouter.com)
- [Zustand æ–‡æ¡£](https://docs.pmnd.rs/zustand)
- [æœ¬é¡¹ç›?Supabase é›†æˆæŒ‡å—](./Supabaseé›†æˆæŒ‡å—.md)
- [æ•°æ®åº“è®¾è®¡](./supabaseæ•°æ®åº“è®¾è®?sql)

---

## ğŸ‰ ä¸‹ä¸€æ­?

è®¤è¯åŠŸèƒ½å·²å®Œæˆï¼æ¥ä¸‹æ¥å¯ä»¥å®ç°ï¼š

1. **è¡Œç¨‹ç®¡ç†åŠŸèƒ½**
   - åˆ›å»ºè¡Œç¨‹
   - æŸ¥çœ‹è¡Œç¨‹åˆ—è¡¨
   - è¡Œç¨‹è¯¦æƒ…é¡?

2. **è´¹ç”¨ç®¡ç†åŠŸèƒ½**
   - è®°å½•è´¹ç”¨
   - è´¹ç”¨ç»Ÿè®¡
   - é¢„ç®—ç®¡ç†

3. **ç”¨æˆ·èµ„æ–™åŠŸèƒ½**
   - ç¼–è¾‘èµ„æ–™
   - ä¸Šä¼ å¤´åƒ
   - ä¿®æ”¹å¯†ç 

4. **AI åŠŸèƒ½é›†æˆ**
   - è¡Œç¨‹ç”Ÿæˆ
   - è¯­éŸ³è¯†åˆ«
   - æ™ºèƒ½æ¨è

**ç¥æ‚¨å¼€å‘é¡ºåˆ©ï¼** ğŸš€

