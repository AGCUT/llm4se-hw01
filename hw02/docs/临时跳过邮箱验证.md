# ä¸´æ—¶è·³è¿‡é‚®ç®±éªŒè¯ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰

## âš ï¸ ä»…ç”¨äºå¼€å‘è°ƒè¯?

å¦‚æœæ‚¨åœ¨ç¦ç”¨ Supabase é‚®ç®±éªŒè¯åä»ç„¶é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ä¸´æ—¶ä¿®æ”¹ä»£ç è·³è¿‡éªŒè¯ã€?

---

## æ–¹æ³• 1ï¼šåœ¨ç™»å½•æ—¶å¿½ç•¥éªŒè¯é”™è¯?

ä¿®æ”¹ `frontend/src/store/authStore.ts`ï¼?

```typescript
// ç™»å½•
signIn: async (email: string, password: string) => {
  set({ loading: true, error: null })
  try {
    const { user, session } = await signInWithEmail(email, password)
    
    // ä¸´æ—¶ï¼šå³ä½¿æœªéªŒè¯ä¹Ÿå…è®¸ç™»å½?
    if (user && session) {
      set({ user, session })
      
      // è·å–ç”¨æˆ·èµ„æ–™
      try {
        const profile = await getProfile(user.id)
        set({ profile })
      } catch (error) {
        console.log('è·å–èµ„æ–™å¤±è´¥ï¼Œä½†å…è®¸ç™»å½•')
      }
      
      return // æˆåŠŸè¿”å›ï¼Œä¸æŠ›å‡ºé”™è¯¯
    }
    
  } catch (error: any) {
    // å¦‚æœæ˜¯é‚®ç®±æœªéªŒè¯é”™è¯¯ï¼Œä¸´æ—¶å¿½ç•?
    if (error.message?.includes('Email not confirmed')) {
      console.warn('é‚®ç®±æœªéªŒè¯ï¼Œä½†å…è®¸ç™»å½•ï¼ˆå¼€å‘æ¨¡å¼ï¼‰')
      // ä¸è®¾ç½®é”™è¯¯ï¼Œå…è®¸ç™»å½•
      return
    }
    
    const errorMessage = error.message || 'ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•'
    set({ error: errorMessage })
    throw error
  } finally {
    set({ loading: false })
  }
}
```

---

## æ–¹æ³• 2ï¼šä½¿ç”?Supabase Service Keyï¼ˆä¸æ¨èï¼?

âš ï¸ **è­¦å‘Šï¼šService Key ä¸åº”åœ¨å‰ç«¯ä½¿ç”¨ï¼ä»…ç”¨äºç´§æ€¥è°ƒè¯•ï¼**

ä¸´æ—¶ç¦ç”¨ RLSï¼?

åœ?Supabase SQL Editor æ‰§è¡Œï¼?

```sql
-- âš ï¸ ä»…ç”¨äºå¼€å‘ç¯å¢ƒè°ƒè¯?
ALTER TABLE profiles DISABLE ROW LEVEL SECURITY;
ALTER TABLE trips DISABLE ROW LEVEL SECURITY;
ALTER TABLE expenses DISABLE ROW LEVEL SECURITY;
```

è°ƒè¯•å®Œæˆå?*å¿…é¡»é‡æ–°å¯ç”¨**ï¼?

```sql
-- é‡æ–°å¯ç”¨ RLS
ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE trips ENABLE ROW LEVEL SECURITY;
ALTER TABLE expenses ENABLE ROW LEVEL SECURITY;
```

---

## æ–¹æ³• 3ï¼šç›´æ¥åœ¨æ•°æ®åº“éªŒè¯ç”¨æˆ?

åœ?Supabase SQL Editor æ‰§è¡Œï¼?

```sql
-- æŸ¥æ‰¾æ‚¨çš„ç”¨æˆ· ID
SELECT id, email, email_confirmed_at 
FROM auth.users 
WHERE email = 'your-email@example.com';

-- æ‰‹åŠ¨è®¾ç½®é‚®ç®±ä¸ºå·²éªŒè¯
UPDATE auth.users 
SET email_confirmed_at = NOW()
WHERE email = 'your-email@example.com';

-- éªŒè¯ç»“æœ
SELECT id, email, email_confirmed_at 
FROM auth.users 
WHERE email = 'your-email@example.com';
```

---

## âœ?æ¨èçš„æ­£ç¡®æµç¨?

**ä¸è¦ä½¿ç”¨ä¸Šé¢çš„ä¸´æ—¶æ–¹æ¡ˆï¼è¯·ä½¿ç”¨æ ‡å‡†æµç¨‹ï¼š**

### æ­¥éª¤ 1ï¼šå½»åº•ç¦ç”¨é‚®ç®±éªŒè¯?

Supabase Dashboardï¼?
```
Authentication â†?Providers â†?Email
  â˜?Confirm email
  â˜?Enable email confirmations
  â˜?Secure email change
[Save]
```

### æ­¥éª¤ 2ï¼šç­‰å¾…é…ç½®ç”Ÿæ•?

**ç­‰å¾… 2-5 åˆ†é’Ÿ**

### æ­¥éª¤ 3ï¼šæ¸…é™¤æ‰€æœ‰æ•°æ?

```javascript
// æµè§ˆå™¨æ§åˆ¶å°
localStorage.clear()
sessionStorage.clear()
```

### æ­¥éª¤ 4ï¼šåˆ é™¤æ—§ç”¨æˆ·

Supabase Dashboardï¼?
```
Authentication â†?Users â†?åˆ é™¤æ‚¨çš„æµ‹è¯•ç”¨æˆ·
```

### æ­¥éª¤ 5ï¼šå¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨

```
Ctrl + Shift + R (Windows)
Cmd + Shift + R (Mac)
```

### æ­¥éª¤ 6ï¼šé‡æ–°æ³¨å†?

è®¿é—® /registerï¼Œæ³¨å†Œæ–°è´¦æˆ·ï¼Œåº”è¯¥å¯ä»¥ç›´æ¥ç™»å½•äº†ã€?

---

## ğŸ” è°ƒè¯•æ£€æŸ¥æ¸…å?

- [ ] Supabase Dashboard ä¸­é‚®ç®±éªŒè¯å·²ç¦ç”¨
- [ ] ç‚¹å‡»äº?Save æŒ‰é’®
- [ ] ç­‰å¾…äº†å‡ åˆ†é’Ÿ
- [ ] åˆ é™¤äº†æ—§ç”¨æˆ·ï¼ˆæˆ–æ‰‹åŠ¨éªŒè¯ï¼?
- [ ] æ¸…é™¤äº†æµè§ˆå™¨ç¼“å­˜
- [ ] å¼ºåˆ¶åˆ·æ–°äº†é¡µé?
- [ ] é‡æ–°æ³¨å†Œäº†æ–°è´¦æˆ·

---

## ğŸ’¡ ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼?

Supabase çš„é‚®ç®±éªŒè¯è®¾ç½®æ˜¯**å‰ç»æ€?*çš„ï¼š
- ç¦ç”¨åï¼Œ**æ–°æ³¨å†?*çš„ç”¨æˆ·ä¸éœ€è¦éªŒè¯?
- ä½?*å·²æ³¨å†?*çš„ç”¨æˆ·ä»ä¿æŒåŸæœ‰çš„éªŒè¯çŠ¶æ€?

æ‰€ä»¥æœ€ç®€å•çš„æ–¹æ³•æ˜¯ï¼š
1. ç¦ç”¨é‚®ç®±éªŒè¯
2. åˆ é™¤æ—§ç”¨æˆ?
3. é‡æ–°æ³¨å†Œ

---

**å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œè¯·å‘Šè¯‰æˆ‘å…·ä½“çš„é”™è¯¯ä¿¡æ¯ï¼?*

---

*æœ€åæ›´æ–? 2024-11-07*


