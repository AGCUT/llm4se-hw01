# 修复登录页面一直加载问题

## 问题描述

1. 首页 `http://127.0.0.1:5173/` 一直显示加载中，无法跳转到登录页面
2. React Router Future Flag Warning 警告

## 问题原因

1. **`refreshAuth` 函数阻塞**：`getCurrentUser()` 和 `getCurrentSession()` 可能会超时，导致 `loading` 状态一直为 `true`
2. **`Home.tsx` 依赖 loading 状态**：如果 `loading` 一直为 `true`，页面会一直显示加载中
3. **`useAuth` hook 也可能阻塞**：使用了 `supabase.auth.getSession()`，可能会超时

## 修复方案

### 1. 优化 `authStore.ts` 中的 `refreshAuth` 函数

- 添加 2 秒超时保护
- 使用 `Promise.race` 避免长时间阻塞
- 获取用户资料改为异步执行，不阻塞主流程

### 2. 简化 `App.tsx` 中的认证初始化

- 移除复杂的超时处理逻辑
- 直接调用 `refreshAuth`，它内部已经有超时处理

### 3. 优化 `useAuth.ts` hook

- 添加 2 秒超时保护
- 使用 `Promise.race` 避免 `getSession()` 阻塞
- 添加取消标志，避免内存泄漏

### 4. 修改 `Home.tsx` 页面

- 添加 3 秒超时机制
- 即使 `loading` 为 `true`，3 秒后也显示内容
- 提供更好的用户体验

### 5. React Router 警告

- 已在 `router.tsx` 中添加 `v7_startTransition: true`
- 可能需要重启开发服务器才能生效

## 修复后的行为

1. **认证初始化**：最多等待 2 秒，超时后继续执行
2. **首页加载**：最多显示 3 秒加载动画，然后显示内容
3. **用户体验**：不会一直显示加载中，用户可以正常使用页面

## 测试建议

1. 刷新页面，应该能在 3 秒内看到首页内容
2. 点击"登录"按钮，应该能正常跳转到登录页面
3. 检查浏览器控制台，不应该有长时间阻塞的请求

## 注意事项

- 如果 Supabase 服务响应较慢，可能会有短暂的加载提示，这是正常的
- 超时后，页面会继续显示，但可能没有用户信息（如果未登录）
- 用户资料获取是异步的，不会阻塞页面渲染

