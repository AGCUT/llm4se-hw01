<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æµ‹è¯•ç”¨æˆ·è®¤è¯åŠŸèƒ½</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .container {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    h1 {
      color: #1a202c;
      margin-bottom: 10px;
    }
    .status {
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
    }
    .success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px;
      transition: background 0.2s;
    }
    button:hover {
      background: #5568d3;
    }
    button:disabled {
      background: #cbd5e0;
      cursor: not-allowed;
    }
    .test-section {
      margin: 20px 0;
      padding: 20px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
    }
    input {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border: 2px solid #e2e8f0;
      border-radius: 6px;
      font-size: 14px;
    }
    pre {
      background: #f7fafc;
      padding: 15px;
      border-radius: 6px;
      overflow-x: auto;
      font-size: 12px;
    }
    .button-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” ç”¨æˆ·è®¤è¯åŠŸèƒ½æµ‹è¯•</h1>
    <p>è¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æµ‹è¯•é¡µé¢ï¼Œç”¨äºæµ‹è¯• Supabase è®¤è¯åŠŸèƒ½</p>

    <div id="status" class="status info">
      ç­‰å¾…æµ‹è¯•...
    </div>

    <!-- æµ‹è¯• 1: è¿æ¥æµ‹è¯• -->
    <div class="test-section">
      <h3>1ï¸âƒ£ Supabase è¿æ¥æµ‹è¯•</h3>
      <button onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
      <pre id="connection-result">æœªæµ‹è¯•</pre>
    </div>

    <!-- æµ‹è¯• 2: æ³¨å†Œæµ‹è¯• -->
    <div class="test-section">
      <h3>2ï¸âƒ£ ç”¨æˆ·æ³¨å†Œæµ‹è¯•</h3>
      <input type="text" id="reg-username" placeholder="ç”¨æˆ·å" value="testuser">
      <input type="email" id="reg-email" placeholder="é‚®ç®±" value="test@example.com">
      <input type="password" id="reg-password" placeholder="å¯†ç " value="test123456">
      <button onclick="testRegister()">æµ‹è¯•æ³¨å†Œ</button>
      <pre id="register-result">æœªæµ‹è¯•</pre>
    </div>

    <!-- æµ‹è¯• 3: ç™»å½•æµ‹è¯• -->
    <div class="test-section">
      <h3>3ï¸âƒ£ ç”¨æˆ·ç™»å½•æµ‹è¯•</h3>
      <input type="email" id="login-email" placeholder="é‚®ç®±" value="test@example.com">
      <input type="password" id="login-password" placeholder="å¯†ç " value="test123456">
      <button onclick="testLogin()">æµ‹è¯•ç™»å½•</button>
      <pre id="login-result">æœªæµ‹è¯•</pre>
    </div>

    <!-- æµ‹è¯• 4: è·å–ç”¨æˆ·ä¿¡æ¯ -->
    <div class="test-section">
      <h3>4ï¸âƒ£ è·å–ç”¨æˆ·ä¿¡æ¯</h3>
      <div class="button-group">
        <button onclick="testGetUser()">è·å–å½“å‰ç”¨æˆ·</button>
        <button onclick="testGetSession()">è·å–ä¼šè¯</button>
        <button onclick="testGetProfile()">è·å–ç”¨æˆ·èµ„æ–™</button>
      </div>
      <pre id="user-result">æœªæµ‹è¯•</pre>
    </div>

    <!-- æµ‹è¯• 5: ç™»å‡ºæµ‹è¯• -->
    <div class="test-section">
      <h3>5ï¸âƒ£ ç”¨æˆ·ç™»å‡ºæµ‹è¯•</h3>
      <button onclick="testLogout()">æµ‹è¯•ç™»å‡º</button>
      <pre id="logout-result">æœªæµ‹è¯•</pre>
    </div>

    <div class="test-section">
      <h3>ğŸ“ ä½¿ç”¨è¯´æ˜</h3>
      <ol>
        <li>ç¡®ä¿å·²åœ¨ <code>.env.local</code> ä¸­é…ç½® Supabase å‡­è¯</li>
        <li>å…ˆæµ‹è¯•è¿æ¥ï¼Œç¡®ä¿ Supabase é…ç½®æ­£ç¡®</li>
        <li>æŒ‰é¡ºåºæµ‹è¯•ï¼šæ³¨å†Œ â†’ ç™»å½• â†’ è·å–ç”¨æˆ·ä¿¡æ¯ â†’ ç™»å‡º</li>
        <li>å¦‚æœæ³¨å†Œå¤±è´¥ï¼ˆç”¨æˆ·å·²å­˜åœ¨ï¼‰ï¼Œç›´æ¥æµ‹è¯•ç™»å½•å³å¯</li>
        <li>æ‰€æœ‰ç»“æœä¼šæ˜¾ç¤ºåœ¨å¯¹åº”çš„æµ‹è¯•åŒºåŸŸ</li>
      </ol>
    </div>
  </div>

  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

    // ä»ç¯å¢ƒå˜é‡è·å–é…ç½®ï¼ˆéœ€è¦å¯åŠ¨ Vite å¼€å‘æœåŠ¡å™¨ï¼‰
    // æˆ–è€…ç›´æ¥åœ¨è¿™é‡Œå¡«å†™æ‚¨çš„é…ç½®
    const SUPABASE_URL = 'YOUR_SUPABASE_URL'
    const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY'

    let supabase = null

    function showStatus(message, type = 'info') {
      const statusEl = document.getElementById('status')
      statusEl.className = `status ${type}`
      statusEl.textContent = message
    }

    function showResult(elementId, data) {
      const el = document.getElementById(elementId)
      el.textContent = JSON.stringify(data, null, 2)
    }

    // åˆå§‹åŒ– Supabase
    function initSupabase() {
      if (SUPABASE_URL === 'YOUR_SUPABASE_URL' || SUPABASE_ANON_KEY === 'YOUR_SUPABASE_ANON_KEY') {
        showStatus('âŒ è¯·å…ˆé…ç½® Supabase URL å’Œ ANON_KEY', 'error')
        alert('è¯·åœ¨æ­¤ HTML æ–‡ä»¶ä¸­å¡«å…¥æ‚¨çš„ SUPABASE_URL å’Œ SUPABASE_ANON_KEY\n\næˆ–é€šè¿‡ Vite å¼€å‘æœåŠ¡å™¨è®¿é—®æ­¤é¡µé¢')
        return false
      }

      supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
      return true
    }

    // æµ‹è¯•è¿æ¥
    window.testConnection = async function() {
      if (!initSupabase()) return
      
      try {
        showStatus('ğŸ”„ æµ‹è¯•è¿æ¥ä¸­...', 'info')
        const { data, error } = await supabase.from('profiles').select('count').limit(1)
        
        if (error) throw error
        
        showStatus('âœ… Supabase è¿æ¥æˆåŠŸï¼', 'success')
        showResult('connection-result', { 
          status: 'success',
          message: 'æ•°æ®åº“è¿æ¥æ­£å¸¸',
          data 
        })
      } catch (error) {
        showStatus('âŒ è¿æ¥å¤±è´¥', 'error')
        showResult('connection-result', { 
          status: 'error',
          message: error.message 
        })
      }
    }

    // æµ‹è¯•æ³¨å†Œ
    window.testRegister = async function() {
      if (!initSupabase()) return

      const username = document.getElementById('reg-username').value
      const email = document.getElementById('reg-email').value
      const password = document.getElementById('reg-password').value

      try {
        showStatus('ğŸ”„ æ³¨å†Œä¸­...', 'info')
        const { data, error } = await supabase.auth.signUp({
          email,
          password,
          options: {
            data: { username }
          }
        })

        if (error) throw error

        showStatus('âœ… æ³¨å†ŒæˆåŠŸï¼è¯·æ£€æŸ¥é‚®ç®±éªŒè¯', 'success')
        showResult('register-result', {
          status: 'success',
          user: data.user,
          session: data.session
        })
      } catch (error) {
        showStatus('âŒ æ³¨å†Œå¤±è´¥', 'error')
        showResult('register-result', {
          status: 'error',
          message: error.message
        })
      }
    }

    // æµ‹è¯•ç™»å½•
    window.testLogin = async function() {
      if (!initSupabase()) return

      const email = document.getElementById('login-email').value
      const password = document.getElementById('login-password').value

      try {
        showStatus('ğŸ”„ ç™»å½•ä¸­...', 'info')
        const { data, error } = await supabase.auth.signInWithPassword({
          email,
          password
        })

        if (error) throw error

        showStatus('âœ… ç™»å½•æˆåŠŸï¼', 'success')
        showResult('login-result', {
          status: 'success',
          user: data.user,
          session: data.session
        })
      } catch (error) {
        showStatus('âŒ ç™»å½•å¤±è´¥', 'error')
        showResult('login-result', {
          status: 'error',
          message: error.message
        })
      }
    }

    // è·å–ç”¨æˆ·ä¿¡æ¯
    window.testGetUser = async function() {
      if (!initSupabase()) return

      try {
        const { data, error } = await supabase.auth.getUser()
        if (error) throw error

        showStatus('âœ… è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ', 'success')
        showResult('user-result', {
          status: 'success',
          user: data.user
        })
      } catch (error) {
        showStatus('âŒ è·å–å¤±è´¥', 'error')
        showResult('user-result', {
          status: 'error',
          message: error.message
        })
      }
    }

    // è·å–ä¼šè¯
    window.testGetSession = async function() {
      if (!initSupabase()) return

      try {
        const { data, error } = await supabase.auth.getSession()
        if (error) throw error

        showStatus('âœ… è·å–ä¼šè¯æˆåŠŸ', 'success')
        showResult('user-result', {
          status: 'success',
          session: data.session
        })
      } catch (error) {
        showStatus('âŒ è·å–å¤±è´¥', 'error')
        showResult('user-result', {
          status: 'error',
          message: error.message
        })
      }
    }

    // è·å–ç”¨æˆ·èµ„æ–™
    window.testGetProfile = async function() {
      if (!initSupabase()) return

      try {
        const { data: { user } } = await supabase.auth.getUser()
        if (!user) throw new Error('æœªç™»å½•')

        const { data, error } = await supabase
          .from('profiles')
          .select('*')
          .eq('id', user.id)
          .single()

        if (error) throw error

        showStatus('âœ… è·å–ç”¨æˆ·èµ„æ–™æˆåŠŸ', 'success')
        showResult('user-result', {
          status: 'success',
          profile: data
        })
      } catch (error) {
        showStatus('âŒ è·å–å¤±è´¥', 'error')
        showResult('user-result', {
          status: 'error',
          message: error.message
        })
      }
    }

    // æµ‹è¯•ç™»å‡º
    window.testLogout = async function() {
      if (!initSupabase()) return

      try {
        showStatus('ğŸ”„ ç™»å‡ºä¸­...', 'info')
        const { error } = await supabase.auth.signOut()
        
        if (error) throw error

        showStatus('âœ… ç™»å‡ºæˆåŠŸï¼', 'success')
        showResult('logout-result', {
          status: 'success',
          message: 'å·²æˆåŠŸç™»å‡º'
        })
      } catch (error) {
        showStatus('âŒ ç™»å‡ºå¤±è´¥', 'error')
        showResult('logout-result', {
          status: 'error',
          message: error.message
        })
      }
    }

    // é¡µé¢åŠ è½½æ—¶æç¤º
    showStatus('è¯·å…ˆé…ç½® Supabase URL å’Œ ANON_KEYï¼Œç„¶åç‚¹å‡»"æµ‹è¯•è¿æ¥"', 'info')
  </script>
</body>
</html>

